
# 5-å›¾è®º


---

## æœ€çŸ­è·¯

## dijkstra

```cpp
#include <bits/stdc++.h>
using namespace std;
#define ll long long
const ll maxn = 10+1e5;
const ll inf = 0x3f3f3f3f;
typedef pair<ll,ll> pll;
    vector<pll> mp[100100];
    ll n,m,s;
    ll dis[100100];
    ll vis[100100];

void dij(ll s){
    for(ll i=1;i<=n;i++){
        dis[i]=inf;
    }
    dis[s]=0;
    priority_queue<pll,vector<pll>,greater<pll> > q;
    q.push({dis[s],s});
    while(!q.empty()){
        ll u=q.top().second;
        q.pop();
        if(vis[u]) continue;
        vis[u]=1;
        for(auto [w,v]:mp[u]){
            if(dis[u]+w<dis[v]){
                dis[v]=dis[u]+w;
                q.push({dis[v],v});
            }
        }
    }
}
int main() {
	cin>>n>>m>>s;
	for(ll i=1;i<=m;i++){
    	ll u,v,w;
    	cin>>u>>v>>w;
    	mp[u].push_back({w,v});
	}
	dij(s);
	for(ll i=1;i<=n;i++)
        cout<<dis[i]<<" ";
    return 0;
}
```

## å¹¶æŸ¥é›†

> å·²ç§»è‡³æ•°æ®ç»“æ„éƒ¨åˆ†

## æœ€å°ç”Ÿæˆæ ‘

### prim O(n^2)

```cpp
    vector<pll> edge[maxn];
    ll dis[maxn];
    ll vis[maxn];
void update(ll u){
    for(auto [v,w]:edge[u]){
        dis[v]=min(dis[v],w);
    }

}
ll prim(ll n){
    for(ll i=1;i<=n;i++){
        vis[i]=0;
        dis[i]=inf;
    }
    vis[1]=1;
    update(1);
    ll ans=0;
    for(ll i=1;i<=n-1;i++){//è¿æ¥n-1æ¡è¾¹
        ll pos,mi=inf;
        for(ll j=1;j<=n;j++){
            if(vis[j]) continue;
            if(dis[j]<mi){
                mi=dis[j];
                pos=j;
            }
        }
        ans+=mi;
        vis[pos]=1;
        update(pos);    
    }
    return ans;
}
```

### prim O(mlogm) (å°æ ¹å †ä¼˜åŒ–)
```cpp
    vector<pll> edge[maxn];
    ll dis[maxn];
    ll vis[maxn];
ll prim(ll n){
    for(ll i=1;i<=n;i++){
        vis[i]=0;
        dis[i]=inf;
    }
    ll ans=0;
    priority_queue<pll,vector<pll>,greater<pll>> pq;
    pq.push({0,1});
    while(!pq.empty()){
        auto [d,u]=pq.top();
        pq.pop();
        if(vis[u]) continue;
        vis[u]=1;
        ans+=d;
        for(auto [v,w]:edge[u]){
            if(!vis[v]&&w<dis[v]){
                dis[v]=w;
                pq.push({dis[v],v});
            }
        }
    }
    return ans;
}
```

### kruskal

```cpp
typedef struct{
    ll u,v,w;
}eg;
    eg e[maxm];
    vector<pll> edge[maxn];
    ll fa[maxn];
bool cmp(eg a,eg b){
    return a.w<b.w;
}
ll find(ll a){
    return (fa[a]==a)?a:(fa[a]=find(fa[a]));
}
void merge(ll a,ll b){
    fa[a]=b;
}
ll kruscal(ll n,ll m){
    for(ll i=1;i<=n;i++){
        fa[i]=i;
    }
    sort(e+1,e+m+1,cmp);
    ll ans=0;
    for(ll i=1;i<=m;i++){
        ll a=find(e[i].u);
        ll b=find(e[i].v);
        if(a!=b){
            merge(a,b);
            ans+=e[i].w;
            n--;
        }
    }
    if(n==1){
        return ans;
    }else{
        return inf;
    }
}
for(ll i=1;i<=m;i++){
    ll u,v,w;
    cin>>u>>v>>w;
    edge[u].push_back({v,w});
    edge[v].push_back({u,w});
    e[i].u=u;e[i].v=v;e[i].w=w;
}
```

## åŸºäºå€å¢çš„LCA

```cpp
#include <bits/stdc++.h>
using namespace std;
#define IOS ios::sync_with_stdio(false),cin.tie(nullptr), cout.tie(nullptr);
#define ll long long
#define ull unint long long
#define lowbit(i) ((i) & (-i))
#define ls(p) (p << 1)
#define rs(p) (p << 1 | 1)
#define rep(i, a, b) for (ll i = a; i <= b; i++)
#define per(i, a, b) for (ll i = a; i >= b; i--)

typedef pair<ll, ll> pll;
const ll mod = 1e9 + 7;
const ll inf = 0x3f3f3f3f;
const ll maxn = 5e5 + 200;

    ll n, q, root; 
    vector<ll> mp[N];
    ll lg2[maxn];
    ll dep[maxn];
    ll f[maxn][20];
    ll vis[maxn];
void dfs(ll u, ll fa = 0){
    if (vis[u]) return;
    vis[u] = 1;
    dep[u] = dep[fa] + 1;
    f[u][0] = fa;
    for (ll i = 1; i <= lg2[dep[u]]; i++){
        f[u][i] = f[f[u][i - 1]][i - 1];
    }
    for (auto v : mp[u]){
        dfs(v, u);
    }
}
ll lca(ll a, ll b){
    if (dep[a] > dep[b])
        swap(a, b);
    while (dep[a] != dep[b])
        b = f[b][lg2[dep[b] - dep[a]]];
    if (a == b)
        return a;
    for (ll k = lg2[dep[a]]; k >= 0; k--){
        if (f[a][k] != f[b][k]){
            a = f[a][k], b = f[b][k];
        }
    }
    return f[a][0];
}
int main(){
    IOS 
    cin >> n >> q >> root;
    for (ll i = 1; i < n; i++){
        ll u, v;
        cin >> u >> v;
        mp[u].push_back(v);
        mp[v].push_back(u);
    }
    for (ll i = 2; i <= n; i++){
        lg2[i] = lg2[i / 2] + 1;
    }
    dfs(root);
    while (q--){
        ll u, v;
        cin >> u >> v;
        cout << lca(u, v) << endl;
    }
    return 0;
}
```

## æœ‰å‘å›¾å¼ºè”é€šåˆ†é‡

æœ‰å‘éå¼ºè¿é€šå›¾ä¸­çš„**æå¤§**å¼ºè¿é€šå­å›¾æˆ‘ä»¬ç§°ä¸º**å¼ºè¿é€šåˆ†é‡**

å¦‚æœä¸€ä¸ªæœ‰å‘å›¾ä¸æ˜¯å¼ºè¿é€šå›¾ä½†æ˜¯å°†**æ‰€æœ‰æœ‰å‘è¾¹æ¢æˆæ— å‘è¾¹**å˜æˆäº†å¼ºè¿é€šå›¾ï¼Œé‚£ä¹ˆè¯¥å›¾å°±æ˜¯**å¼±è¿é€šå›¾**ã€‚

Kosarajuç®—æ³•

é¦–å…ˆå¯¹åŸå›¾$G$è¿›è¡Œéå†ï¼Œè®°å½•èŠ‚ç‚¹è®¿é—®**å®Œ**çš„é¡ºåº$d_i$ï¼Œ$d_i$ è¡¨ç¤ºç¬¬$i$ä¸ªè®¿é—®å®Œçš„èŠ‚ç‚¹ç¼–å·ã€‚

æˆ‘ä»¬é€‰æ‹©æœ€æ™š**è®¿é—®å®Œ**çš„èŠ‚ç‚¹ï¼Œå¯¹$G$çš„åå‘å›¾è¿›è¡Œéå†ï¼Œå®ƒèƒ½å¤Ÿéå†åˆ°çš„é¡¶ç‚¹å’Œå®ƒç»„æˆäº†ä¸€ä¸ª SCCï¼ŒæŠŠè¯¥è¿‡ç¨‹æ‰€éå†åˆ°çš„èŠ‚ç‚¹æ‰“æ ‡è®°ï¼Œæ¥ä¸‹æ¥ç»§ç»­æ‰¾æœ€æ™š**è®¿é—®å®Œ**ä¸”æœªè¢«æ‰“ä¸Šæ ‡è®°çš„èŠ‚ç‚¹è¿›è¡Œéå†æ“ä½œã€‚

```cpp
#include <bits/stdc++.h>
#define ll long long
using namespace std;
const int Maxn=1e5+7;
int n,m;
vector<int>e[Maxn],e1[Maxn];
// e å­˜æ­£å‘è¾¹,e1 å­˜åå‘è¾¹ 
bool vis[Maxn];
int d[Maxn],cnt,col[Maxn],cnt1;
void dfs1(int u){
	vis[u]=1;
	for(auto v:e[u]) if(!vis[v]) dfs1(v);
	d[++cnt]=u;
}
vector<int>ans[Maxn];
void dfs2(int u){
	col[u]=cnt1;
	ans[cnt1].push_back(u);
	for(auto v:e1[u]) if(!col[v]) dfs2(v);
}
int main(){
	scanf("%d%d",&n,&m);
	for(int i=1,u,v;i<=m;i++){
		scanf("%d%d",&u,&v);
		e[u].push_back(v);
		e1[v].push_back(u);
	}
	for(int i=1;i<=n;i++) if(!vis[i]) dfs1(i);
	for(int i=n;i;i--) if(!col[d[i]]) ++cnt1,dfs2(d[i]);
	for(int i=1;i<=cnt1;i++) sort(ans[i].begin(),ans[i].end());
	printf("%d\n",cnt1);
	for(int i=1;i<=n;i++){
		if(ans[col[i]].size()){
			for(auto j:ans[col[i]]) printf("%d ",j);
			puts("");
			ans[col[i]].resize(0);
		}
	}
	return 0;
}
```

Tarjanç®—æ³•

åœ¨ DFS è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å¦‚ä¸‹ 4 ç§è¾¹ï¼š

- æ ‘æè¾¹ï¼šDFS è¿‡ç¨‹ä¸­ç»è¿‡çš„è¾¹ï¼Œå³ DFS æœç´¢æ ‘ä¸Šçš„è¾¹ã€‚

- å‰å‘è¾¹ï¼šä»ç¥–å…ˆèŠ‚ç‚¹æŒ‡å‘åä»£èŠ‚ç‚¹çš„éæ ‘æè¾¹ï¼Œæˆ‘ä»¬ç§°ä¸ºå‰å‘è¾¹ã€‚

- è¿”ç¥–è¾¹ï¼ˆåå‘è¾¹ï¼‰ï¼šä»åä»£èŠ‚ç‚¹æŒ‡å‘ç¥–å…ˆèŠ‚ç‚¹çš„éæ ‘æè¾¹ï¼Œæˆ‘ä»¬ç§°ä¸ºè¿”ç¥–è¾¹ï¼ˆåå‘è¾¹ï¼‰ã€‚

- æ¨ªå‰è¾¹ï¼šä¸¤ç«¯æ— ç¥–å…ˆå…³ç³»çš„éæ ‘æè¾¹ï¼Œæˆ‘ä»¬ç§°ä¸ºæ¨ªå‰è¾¹ã€‚

  æ¯ä¸ªå¼ºè¿é€šåˆ†é‡éƒ½æ˜¯ DFS æ ‘çš„ä¸€é¢—å­æ ‘ï¼Œæœç´¢æ—¶ï¼ŒæŠŠå½“å‰ DFS æ ‘ç§æœªå¤„ç†çš„èŠ‚ç‚¹åŠ å…¥ä¸€ä¸ªæ ˆï¼Œå›æº¯æ—¶å¯ä»¥åˆ¤æ–­æ ˆé¡¶åˆ°æ ˆä¸­çš„èŠ‚ç‚¹æ˜¯å¦æ„æˆä¸€ä¸ªå¼ºè¿é€šåˆ†é‡ã€‚

æˆ‘ä»¬ä¸å¦¨å®šä¹‰$dfn(u)$è¡¨ç¤ºèŠ‚ç‚¹$u$åœ¨ DFS ä¸­çš„éå†ç¼–å·ï¼ˆ**æ—¶é—´æˆ³**ï¼‰ï¼Œ$low(u)$è¡¨ç¤º$u$æˆ–$u$çš„å­æ ‘èƒ½å¤Ÿæœ€å¤šåªé€šè¿‡**ä¸€æ¡éæ ‘æè¾¹ï¼ˆä¸åŒ…å«æ ‘è¾¹ï¼‰**å›æº¯çš„æœ€æ—©çš„$dfn$å€¼ï¼Œç”¨ä¸€ä¸ªæ ˆè®°å½•ç»è¿‡çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š

- åˆå§‹æƒ…å†µæœ‰$low(u)=dfn(u)$ã€‚
- å¯¹äºè¾¹$(u,v)$ ï¼Œå¦‚æœ$u$ä¸º$v$çš„çˆ¶äº²èŠ‚ç‚¹ï¼Œåˆ™æœ‰$low(u)=min(low(u),low(v))$ã€‚
- å¯¹äºè¾¹$(u,v)$ä¸ºè¿”ç¥–è¾¹æˆ–è€…æŒ‡å‘éå…¶ä»–å¼ºè¿é€šçš„æ¨ªå‰è¾¹ï¼Œåˆ™æœ‰$low(u)=min(low(u),dfn(v))$ã€‚

åœ¨èŠ‚ç‚¹$u$æœç´¢å®Œæ¯•ä¹‹åï¼Œå¦‚æœ$low(u)=dfn(u)$ï¼Œé‚£ä¹ˆè¯´æ˜ä»¥$u$ä¸º**æ ¹èŠ‚ç‚¹**çš„æœç´¢å­æ ‘ä¸ŠåŠæ ˆä¸­åœ¨$u$å†…çš„å…ƒç´ ç»„æˆäº†ä¸€ä¸ªå¼ºè¿é€šåˆ†é‡ï¼Œç„¶ååˆ é™¤æ ˆå†…çš„è¿™äº›å…ƒç´ ï¼Œä¸æ–­é‡å¤è¯¥æ“ä½œç›´åˆ°æ‰¾åˆ°æ‰€æœ‰çš„å¼ºè¿é€šåˆ†é‡ã€‚

ä¾‹ [P3387 ã€æ¨¡æ¿ã€‘ç¼©ç‚¹ - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)](https://www.luogu.com.cn/problem/P3387)

```cpp
#include <bits/stdc++.h>
#define ll long long
using namespace std;
const int Maxn=1e5+7;
int n,m;
vector<int>e[Maxn];
int col[Maxn],dfn[Maxn],low[Maxn],cnt;
int stk[Maxn],top,_cnt;
vector<int>ans[Maxn];
void Tarjan(int u){
	dfn[u]=low[u]=++cnt;
	stk[++top]=u;
	for(auto v:e[u]){
		if(!dfn[v]) Tarjan(v),low[u]=min(low[u],low[v]);
		else if(!col[v]) low[u]=min(low[u],dfn[v]);
	}
	if(low[u]==dfn[u]){
		col[u]=++_cnt;
		ans[_cnt].push_back(u);
		while(stk[top]!=u) 	
			ans[_cnt].push_back(stk[top]),col[stk[top--]]=_cnt;
		--top;
	}
}
int main(){
	scanf("%d%d",&n,&m);
	for(int i=1,u,v;i<=m;i++){
		scanf("%d%d",&u,&v);
		e[u].push_back(v);
	}
	for(int i=1;i<=n;i++) if(!dfn[i]) Tarjan(i);
	for(int i=1;i<=_cnt;i++) sort(ans[i].begin(),ans[i].end());
	printf("%d\n",_cnt);
	for(int i=1;i<=n;i++){
		if(ans[col[i]].size()){
			for(auto j:ans[col[i]]) printf("%d ",j);
			puts("");
			ans[col[i]].resize(0);
		}
	}
	return 0;
}
```

## å‰²ç‚¹å‰²è¾¹

- å‰²ç‚¹ï¼šåœ¨**æ— å‘å›¾**ä¸­ï¼Œåˆ å»è¯¥ç‚¹åä½¿å¾—è¿é€šå—æ•°å¢åŠ çš„ç»“ç‚¹ç§°ä¸º **å‰²ç‚¹**ã€‚
- å‰²è¾¹ï¼ˆæ¡¥ï¼‰ï¼šåœ¨**æ— å‘å›¾**ä¸­ï¼Œåˆ å»è¯¥è¾¹åä½¿å¾—è¿é€šå—æ•°å¢åŠ çš„è¾¹ç§°ä¸º **å‰²è¾¹ï¼ˆæ¡¥ï¼‰**ã€‚

ä¸€ä¸ªå›¾å¯èƒ½ä¼šæœ‰å¤šä¸ªå‰²ç‚¹æˆ–è€…å‰²è¾¹ï¼Œä½†æ˜¯æœ‰å‰²ç‚¹çš„å›¾ä¸ä¸€å®šå­˜åœ¨å‰²è¾¹ï¼Œæœ‰å‰²è¾¹çš„å›¾ä¸ä¸€å®šå­˜åœ¨å‰²ç‚¹ã€‚



### å‰²ç‚¹

å’Œæœ‰å‘å›¾æ±‚ SCC ä¸€æ ·ï¼Œæˆ‘ä»¬ä¼šåœ¨æœç´¢è¿‡ç¨‹ä¸­é‡åˆ°ä¸¤ç§æœç´¢æ ‘ä¸Šçš„è¾¹ï¼š

- æ ‘æè¾¹ï¼šDFS è¿‡ç¨‹ä¸­ç»è¿‡çš„è¾¹ï¼Œå³ DFS æœç´¢æ ‘ä¸Šçš„è¾¹ã€‚
- è¿”ç¥–è¾¹ï¼ˆåå‘è¾¹ï¼‰ï¼šä»åä»£èŠ‚ç‚¹æŒ‡å‘ç¥–å…ˆèŠ‚ç‚¹çš„éæ ‘æè¾¹ï¼Œæˆ‘ä»¬ç§°ä¸ºè¿”ç¥–è¾¹ï¼ˆåå‘è¾¹ï¼‰ã€‚

ä¸åŒ…å«æ¨ªå‰è¾¹å’Œå‰å‘è¾¹ï¼Œå› ä¸ºè¿™æ˜¯**æ— å‘å›¾**ã€‚

æˆ‘ä»¬ä¸å¦¨å®šä¹‰$dfn(u)$è¡¨ç¤ºèŠ‚ç‚¹$u$åœ¨ DFS ä¸­çš„éå†ç¼–å·ï¼ˆ**æ—¶é—´æˆ³**ï¼‰ï¼Œ$low(u)$ è¡¨ç¤º$u$æˆ–$u$çš„å­æ ‘èƒ½å¤Ÿæœ€å¤šåªé€šè¿‡**ä¸€æ¡éæ ‘æè¾¹ï¼ˆä¸åŒ…å«æ ‘è¾¹ï¼‰**å›æº¯çš„æœ€æ—©çš„$dfn$å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š

- åˆå§‹æƒ…å†µæœ‰$low(u)=dfn(u)$ã€‚
- å¯¹äºè¾¹$(u,v)$ï¼Œå¦‚æœ$v$æ²¡æœ‰è¢«æœç´¢åˆ°ï¼Œé‚£ä¹ˆè¿™æ¡è¾¹å°±æ˜¯æ ‘æè¾¹ï¼Œåˆ™æœ‰$low(u)=min(low(u),low(v))$ã€‚
- å¯¹äºè¾¹$(u,v)$ï¼Œå¦‚æœ$v$è¢«æœç´¢åˆ°äº†ï¼Œé‚£ä¹ˆè¿™æ¡è¾¹å°±æ˜¯è¿”ç¥–è¾¹ï¼Œåˆ™æœ‰$low(u)=min(low(u),dfn(v))$ã€‚

å¯¹äºä¸€ä¸ªèŠ‚ç‚¹$uâ€‹$ï¼Œå®ƒçš„å­èŠ‚ç‚¹$vâ€‹$ï¼Œè‹¥$low(v)\geq dfn(u)â€‹$ï¼Œè¯´æ˜$vâ€‹$æ— æ³•é€šè¿‡å®ƒå­æ ‘çš„èŠ‚ç‚¹åˆ°è¾¾$dfnâ€‹$æ›´å°çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯$vâ€‹$æ— æ³•ä¸ç»è¿‡ç‚¹$uâ€‹$åˆ°è¾¾æ¯”$uâ€‹$çš„$dfnâ€‹$å€¼æ›´å°çš„èŠ‚ç‚¹ï¼Œæ˜¾ç„¶$uâ€‹$æ˜¯ä¸€ä¸ªå‰²ç‚¹ï¼Œåä¹‹ ğ‘¢ $uâ€‹$å°±ä¸æ˜¯ä¸€ä¸ªå‰²ç‚¹ã€‚

ä½†æ˜¯å¯¹äºæ ¹èŠ‚ç‚¹$u$ï¼Œå®ƒçš„$dfn$å€¼ä¸€å®šæ˜¯æ•´ä¸ªåºåˆ—çš„æœ€å°å€¼ï¼Œå› æ­¤ä¸Šè¿°æ–¹æ³•ä¸ç®¡ç”¨ï¼Œå¦‚æœå®ƒå­˜åœ¨ä¸¤ä¸ªåŠä»¥ä¸Šçš„å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæŠŠ$u$åˆ é™¤åç»å¯¹ä¼šæŠŠ$u$å­èŠ‚ç‚¹çš„å­æ ‘åˆ†å‰²å¼€æ¥ï¼Œæ­¤æ—¶$u$æ˜¯å‰²ç‚¹ã€‚

```cpp
#include <bits/stdc++.h>
#define ll long long
using namespace std;
const ll Maxn=1e5+7;
struct edge1{
	ll v,Next;
}Edge[Maxn<<1];
ll n,m,tot,low[Maxn],dfn[Maxn],cnt,root,ans,head[Maxn];
bool flg[Maxn];
inline void add(ll u,ll v){
	Edge[++tot]=(edge1){v,head[u]},head[u]=tot;
}
void tarjan(ll u){
	dfn[u]=low[u]=++cnt;
	ll ch=0;
	for(ll i=head[u];i;i=Edge[i].Next){
		ll v=Edge[i].v;
		if(!dfn[v]){
			ch++;
			tarjan(v);
			low[u]=min(low[u],low[v]);
			if(low[v]>=dfn[u]&&u!=root) flg[u]=1;
			
		}
		else low[u]=min(low[u],dfn[v]);
	}
	if(ch>=2&&root==u) flg[u]=1;
}
int main(){
	scanf("%lld%lld",&n,&m);
	for(ll i=1,u,v;i<=m;i++) 
		scanf("%lld%lld",&u,&v),add(u,v),add(v,u); 
	for(ll i=1;i<=n;i++)
		if(!dfn[i])
			root=i,tarjan(i);
	for(ll i=1;i<=n;i++)
		if(flg[i])
			++ans;
	printf("%lld\n",ans);
	for(ll i=1;i<=n;i++)
		if(flg[i])
			printf("%lld ",i);
	return 0;
}
```

### å‰²è¾¹

å‰²è¾¹çš„æ±‚æ³•å’Œå‰²ç‚¹çš„æ±‚æ³•ç±»ä¼¼ï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨ç›¸åŒå®šä¹‰çš„$low$å’Œ$dfn$ã€‚

å¾ˆæ˜¾ç„¶ï¼Œæ ‘æè¾¹ä½¿å¾—æ•´ä¸ªå›¾è¿é€šï¼Œè€Œéæ ‘è¾¹åˆ é™¤åå¹¶ä¸å½±å“å›¾çš„è¿é€šæ€§ï¼Œå› æ­¤**å‰²è¾¹ä¸€å®šæ˜¯æ ‘æè¾¹**ã€‚

å‡è®¾å½“å‰èŠ‚ç‚¹ä¸º$u$ï¼Œå®ƒæœ‰å­èŠ‚ç‚¹$v$ï¼Œé‚£ä¹ˆè¾¹$(u,v)$ä¸ºå‰²è¾¹æ—¶å½“ä¸”ä»…å½“$low(v) > dfn(u)$ï¼Œåªè¦$v$çš„èŠ‚ç‚¹èƒ½é€šè¿‡éæ ‘è¾¹æ¥åˆ°æ¯”$u$çš„$dfn$æ›´å°çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆ$u,v$å°±ä¸æ˜¯å‰²è¾¹ï¼Œä¸å–ç­‰å·çš„åŸå› æ˜¯å®ƒæ˜¯ä¸€æ¡è¾¹è€Œéä¸€ä¸ªèŠ‚ç‚¹ã€‚

ç°åœ¨å”¯ä¸€çš„é—®é¢˜å°±æ˜¯åˆ¤æ–­ä¸€æ¡è¾¹æ˜¯å¦ä¸ºéæ ‘è¾¹ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å°†$v \rightarrow uâ€‹$ï¼ˆ$uâ€‹$æ˜¯$vâ€‹$çš„çˆ¶äº²ï¼‰è¯†åˆ«æˆéæ ‘è¾¹ï¼Œè¿™æ ·å¯èƒ½å°†æ ‘è¾¹ä¹Ÿè¯†åˆ«æˆéæ ‘è¾¹ã€‚

tarjan

```cpp
#include<bits/stdc++.h>
#define int long long
const int N=1e6+1;
using namespace std;
struct fy
{
	int v,next;
}edge[N];
struct fy_
{
	int from,to;
}E[N];
int dfn[N],low[N],n,m,x,y,idx,head[N],res,cnt,IDX;
bool g[N];
inline void add(int x,int y)
{
	edge[++cnt].v=y,edge[cnt].next=head[x],head[x]=cnt;
}
inline void dfs(int u,int fa)
{
	dfn[u]=low[u]=++idx;
	for(int i=head[u];i;i=edge[i].next)
	{
		int v=edge[i].v;
		if(!dfn[v])
		{
			dfs(v,u);
			low[u]=min(low[u],low[v]);
			if(low[v]>dfn[u])
				E[++IDX].from=min(u,v),E[IDX].to=max(u,v);
		}
		else if(v!=fa&&dfn[v]<dfn[u])
			low[u]=min(low[u],dfn[v]);
	}
}
signed main()
{
	scanf("%lld%lld",&n,&m);
	for(int i=1;i<=m;i++)
	{
		scanf("%lld%lld",&x,&y);
		add(x,y),add(y,x);
	}
	dfs(1,-1);
	for(int i=1;i<=IDX;i++)
		printf("%lld %lld\n",E[i].from,E[i].to);
}
```

æ ‘ä¸Šå·®åˆ†

å¯¹äºæ¯ä¸€æ¡éæ ‘è¾¹ï¼Œåœ¨å…¶æ ‘ä¸Šæ·±åº¦è¾ƒå°çš„ç‚¹å¤„æ‰“ä¸Š `-1` æ ‡è®°ï¼Œåœ¨å…¶æ ‘ä¸Šæ·±åº¦è¾ƒå¤§çš„ç‚¹å¤„æ‰“ä¸Š `+1` æ ‡è®°ã€‚ç„¶åæ±‚å‡ºæ¯ä¸ªç‚¹çš„å­æ ‘å†…éƒ¨çš„æ ‡è®°ä¹‹å’Œã€‚å¯¹äºä¸€ä¸ªç‚¹uï¼Œå…¶å­æ ‘å†…éƒ¨çš„æ ‡è®°ä¹‹å’Œç­‰äºè¦†ç›–äº† uå’Œuçš„çˆ¶äº²ä¹‹é—´çš„æ ‘è¾¹çš„éæ ‘è¾¹æ•°é‡ã€‚è‹¥è¿™ä¸ªå€¼é0ï¼Œåˆ™uå’Œuçš„çˆ¶äº²ä¹‹é—´çš„æ ‘è¾¹ä¸æ˜¯æ¡¥ï¼Œå¦åˆ™æ˜¯æ¡¥ã€‚

## åŒè”é€šåˆ†é‡

åŒè¿é€šåˆ†é‡åˆ†ä¸º**ç‚¹åŒè¿é€šåˆ†é‡**å’Œ**è¾¹åŒè¿é€šåˆ†é‡**ã€‚

è¾¹åŒè¿é€šå…·æœ‰ä¼ é€’æ€§ï¼Œç‚¹åŒè¿é€š **ä¸** å…·æœ‰ä¼ é€’æ€§

- ç‚¹åŒè¿é€šå›¾ï¼š**ä¸å­˜åœ¨å‰²ç‚¹çš„æ— å‘è¿é€šå›¾**æˆ‘ä»¬ç§°ä¸º**ç‚¹åŒè”é€šå›¾**ã€‚

- è¾¹åŒè¿é€šå›¾ï¼š**ä¸å­˜åœ¨å‰²è¾¹çš„æ— å‘è¿é€šå›¾**æˆ‘ä»¬ç§°ä¸º**è¾¹åŒè”é€šå›¾**ã€‚

- ç‚¹åŒè¿é€šåˆ†é‡ï¼ˆç‚¹åŒï¼‰ï¼šä¸€å¼ å›¾çš„æå¤§ç‚¹åŒè¿é€šå­å›¾ç§°ä¸º**ç‚¹åŒè¿é€šåˆ†é‡ï¼ˆV-BCCï¼‰ã€‚**

- è¾¹åŒè¿é€šåˆ†é‡ï¼ˆè¾¹åŒï¼‰ï¼šä¸€å¼ å›¾çš„æå¤§è¾¹åŒè¿é€šå­å›¾ç§°ä¸º**è¾¹åŒè¿é€šåˆ†é‡ï¼ˆE-BCCï¼‰**ã€‚

- ç‚¹åŒè¿é€šï¼šè‹¥ä¸¤ç‚¹$u,v$åœ¨åŒä¸€ä¸ªç‚¹åŒè¿é€šåˆ†é‡å†…ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°$u,v$ç‚¹åŒè¿é€šã€‚

- è¾¹åŒè”é€šï¼šè‹¥ä¸¤ç‚¹$u,v$åœ¨åŒä¸€ä¸ªè¾¹åŒè¿é€šåˆ†é‡å†…ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°$u,v$è¾¹åŒè¿é€šã€‚

  åœ¨ä¸€å¼ æ— å‘å›¾ä¸­ï¼Œå¦‚æœ$(u,v)$ç›´æ¥ç›¸è¿ï¼Œé‚£ä¹ˆ$u,v$ç‚¹åŒè¿é€šï¼Œä½†ä¸ä¸€å®šè¾¹åŒè¿é€šã€‚

  åŒæ—¶ï¼ŒåŒè¿é€šåˆ†é‡è¿˜æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ€§è´¨ï¼Œæˆ‘ä»¬å°†å¼ºè¿é€šåˆ†é‡ç¼©ç‚¹åå¯ä»¥å¾—åˆ°ä¸€ä¸ª **DAG**ï¼Œä½†æ˜¯åŒè¿é€šåˆ†é‡ç¼©ç‚¹ä¹‹åå¯ä»¥å¾—åˆ°**ä¸€æ£µæ ‘**ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨è¿›é˜¶ä¸­è¦è®²çš„**åœ†æ–¹æ ‘**ã€‚

### è¾¹åŒè¿é€šåˆ†é‡

è¾¹åŒè¿é€šåˆ†é‡äº‹å®ä¸Šå¾ˆå¥½æ±‚ã€‚

æˆ‘ä»¬åªéœ€å°†è¯¥æ— å‘å›¾çš„æ‰€æœ‰å‰²è¾¹åˆ å»ï¼Œæ•´å¼ å›¾å°±ä¼šåˆ†è£‚æˆ**å‰²è¾¹æ•°é‡+1**ä¸ªè”é€šå—ï¼Œè¿™äº›è”é€šå—å†…ä¸å­˜åœ¨å‰²è¾¹ï¼Œä¹Ÿå°±æ˜¯è¯¥å›¾åˆ†è£‚æˆäº†è‹¥å¹²ä¸ªè¾¹åŒè¿é€šåˆ†é‡ã€‚

```cpp
#include <bits/stdc++.h>
#define ll long long
using namespace std;
const ll Maxn=4e6+7;
struct edge1{
	ll u,v,Next;
}Edge[Maxn<<1];
ll n,m,tot=1,f[Maxn];
ll low[Maxn],dfn[Maxn],cnt,head[Maxn];
ll cl;
vector<ll>ans[Maxn];
bool flg[Maxn],vis[Maxn];
inline void add(ll u,ll v){
	Edge[++tot]=(edge1){u,v,head[u]},head[u]=tot;
}
void tarjan(ll u){
	dfn[u]=low[u]=++cnt;
	for(ll i=head[u];i;i=Edge[i].Next){
		if(i==(f[u]^1)) continue;
		ll v=Edge[i].v;
		if(!dfn[v]){
			f[v]=i;
			tarjan(v);
			low[u]=min(low[u],low[v]);
			if(low[v]>dfn[u]) flg[i]=flg[i^1]=1;
		}
		else low[u]=min(low[u],dfn[v]);
	}
}
void DFS(ll u){
	vis[u]=1;
	ans[cl].push_back(u);
	for(ll i=head[u];i;i=Edge[i].Next){
		if(!flg[i]&&!vis[Edge[i].v]){
			DFS(Edge[i].v);
		}
	}
}
int main(){
	scanf("%lld%lld",&n,&m);
	for(ll i=1,u,v;i<=m;i++) 
		scanf("%lld%lld",&u,&v),add(u,v),add(v,u); 
	for(ll i=1;i<=n;i++) if(!dfn[i]) tarjan(i);
	for(ll i=1;i<=n;i++) if(!vis[i]) ++cl,DFS(i);
	printf("%lld\n",cl);
	for(ll i=1;i<=cl;i++,puts("")){
		printf("%lld ",ans[i].size());
		for(auto j:ans[i]) printf("%lld ",j);
	}
	return 0;
}
```

### ç‚¹åŒè¿é€šåˆ†é‡

å¯¹äºä¸€ä¸ªç‚¹åŒï¼Œå®ƒåœ¨ DFS æœç´¢æ ‘ä¸­$dfn$å€¼æœ€å°çš„ç‚¹ä¸€å®šæ˜¯å‰²ç‚¹æˆ–è€…æ ‘æ ¹ã€‚

å½“è¿™ä¸ªç‚¹æ˜¯å‰²ç‚¹æ—¶ï¼Œå®ƒæ‰€å±çš„ç‚¹åŒå¿…å®šä¸å¯ä»¥å‘å®ƒçš„çˆ¶äº²æ–¹å‘åŒ…æ‹¬æ›´å¤šç‚¹ï¼Œå› ä¸ºä¸€æ—¦å›æº¯ï¼Œå®ƒå°±æˆä¸ºäº†æ–°çš„å­å›¾çš„ä¸€ä¸ªå‰²ç‚¹ï¼Œä¸æ˜¯ç‚¹åŒã€‚æ‰€ä»¥å®ƒåº”è¯¥å½’åˆ°å…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå­æ ‘é‡Œçš„ç‚¹åŒä¸­ã€‚

å½“è¿™ä¸ªç‚¹æ˜¯æ ‘æ ¹æ—¶ï¼Œå®ƒçš„$dfn$å€¼æ˜¯æ•´æ£µæ ‘é‡Œæœ€å°çš„ã€‚å®ƒè‹¥æœ‰ä¸¤ä¸ªä»¥ä¸Šå­æ ‘ï¼Œé‚£ä¹ˆå®ƒæ˜¯ä¸€ä¸ªå‰²ç‚¹ï¼›å®ƒè‹¥åªæœ‰ä¸€ä¸ªå­æ ‘ï¼Œå®ƒä¸€å®šå±äºå®ƒçš„ç›´ç³»å„¿å­çš„ç‚¹åŒï¼Œå› ä¸ºåŒ…æ‹¬å®ƒï¼›å®ƒè‹¥æ˜¯ä¸€ä¸ªç‹¬ç«‹ç‚¹ï¼Œè§†ä½œä¸€ä¸ªå•ç‹¬çš„ç‚¹åŒã€‚

æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªç‚¹åŒä¸€å®šåœ¨è¿™ä¸¤ç±»ç‚¹çš„å­æ ‘ä¸­ã€‚

æˆ‘ä»¬ç”¨æ ˆç»´æŠ¤ç‚¹ï¼Œå½“é‡åˆ°è¿™ä¸¤ç±»ç‚¹æ—¶ï¼Œå°†å­æ ‘å†…ç›®å‰ä¸å±äºå…¶å®ƒç‚¹åŒçš„éå‰²ç‚¹æˆ–åœ¨å­æ ‘ä¸­çš„å‰²ç‚¹å½’åˆ°ä¸€ä¸ªæ–°çš„ç‚¹åŒã€‚æ³¨æ„è¿™ä¸ªç‚¹å¯èƒ½è¿˜æ˜¯ä¸å…¶å®ƒç‚¹åŒçš„å…¬å…±ç‚¹ï¼Œæ‰€ä»¥ä¸èƒ½å°†å…¶å‡ºæ ˆã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 5e5 + 5, M = 4e6 + 5;
int cnt = 1, fir[N], nxt[M], to[M];
int s[M], top, bcc, low[N], dfn[N], idx, n, m;
vector<int> ans[N];
inline void tarjan(int u, int fa) {
	int son = 0;
	low[u] = dfn[u] = ++idx;
	s[++top] = u;
	for(int i = fir[u]; i; i = nxt[i]) {
		int v = to[i];
		if(!dfn[v]) {
			son++;
			tarjan(v, u);
			low[u] = min(low[u], low[v]);
			if(low[v] >= dfn[u]) {
				bcc++;
				while(s[top + 1] != v) ans[bcc].push_back(s[top--]);//å°†å­æ ‘å‡ºæ ˆ
				ans[bcc].push_back(u);//æŠŠå‰²ç‚¹/æ ‘æ ¹ä¹Ÿä¸¢åˆ°ç‚¹åŒé‡Œ
			}
		} else if(v != fa) low[u] = min(low[u], dfn[v]);
	}
	if(fa == 0 && son == 0) ans[++bcc].push_back(u);//ç‰¹åˆ¤ç‹¬ç«‹ç‚¹
}
inline void add(int u, int v) {
	to[++cnt] = v;
	nxt[cnt] = fir[u];
	fir[u] = cnt;
}
int main() {
	scanf("%d%d", &n, &m);
	for(int i = 1; i <= m; i++) {
		int u, v;
		scanf("%d%d", &u, &v);
		add(u, v), add(v, u);
	}
	for(int i = 1; i <= n; i++) {
		if(dfn[i]) continue;
		top = 0;
		tarjan(i, 0);
	}
	printf("%d\n", bcc);
	for(int i = 1; i <= bcc; i++) {
		printf("%d ", ans[i].size());
		for(int j : ans[i]) printf("%d ", j);
		printf("\n");
	}
	return 0;
}
```


## æ ‘é“¾å‰–åˆ† HLD

```cpp 
using ll = long long;
using Graph = vector<vector<int>>;
struct HLD
{
    vector<int> id, sz, son, fa, top, dep;
    int root, tot;
    Graph g;

    HLD() {};

    HLD(int _n, int _root = 1)
    {
        init(_n + 1, _root);
    }

    HLD(Graph &_g, int _root = 1)
    {
        init(_g, _root);
    }

    // fundamental functions
    void init(Graph &_g, int _root)
    {
        g = _g;
        id.resize(_g.size());
        sz.resize(_g.size());
        son.resize(_g.size());
        fa.resize(_g.size());
        top.resize(_g.size());
        dep.resize(_g.size());
        tot = 0;
        root = _root;

        calc();
    }

    void init(int n, int _root)
    {
        id.resize(n);
        sz.resize(n);
        son.resize(n);
        fa.resize(n);
        top.resize(n);
        dep.resize(n);
        tot = 0;
        root = _root;
        g.assign(n, {});
        // remember calc()
    }

    void calc()
    { // prepare fa, sz, dep, son(heavy son)
        function<void(int, int)> dfs = [&](int now, int f)
        {
            fa[now] = f;
            sz[now] = 1;
            dep[now] = dep[f] + 1;
            for (auto i : g[now])
                if (i != f)
                {
                    dfs(i, now);
                    sz[now] += sz[i];
                    if (sz[i] > sz[son[now]])
                        son[now] = i;
                }
        };
        dfs(root, root);

        // id -> dfn; top -> head of the chain
        dfs = [&](int now, int f)
        {
            top[now] = f;
            id[now] = ++tot;
            if (son[now] == 0)
                return;
            dfs(son[now], f); // heavy chain
            for (auto i : g[now])
                if (i != fa[now] && i != son[now])
                    dfs(i, i); // light chain
        };
        dfs(root, root);
    }

    void addEdge(int u, int v)
    {
        g[u].push_back(v), g[v].push_back(u);
    }

    // tool functions
    int lca(int x, int y)
    {
        while (top[x] != top[y])
        {
            if (dep[top[x]] > dep[top[y]])
                x = fa[top[x]];
            else
                y = fa[top[y]];
        }
        return (dep[x] > dep[y]) ? y : x;
    }

    int dist(int u, int v)
    {
        return dep[u] + dep[v] - 2 * dep[lca(u, v)];
    }
};
```

å¤„ç†ï¼š
* ä»¥ `u` ä¸ºæ ¹çš„å­æ ‘åœ¨ `id[u], id[u] + sz[u] - 1` åŒºé—´ä¸Šã€‚ 
* å¤„ç†ä¸¤ç‚¹é—´ç®€å•è·¯å¾„çš„å®ä¾‹ï¼Œå…¶ä¸­updateæ˜¯åŒºé—´åŠ ã€‚
```cpp
void pathAdd(int u, int v, int x)
{
    while (top[u] != top[v])
    {
        if (dep[top[u]] < dep[top[v]])
            swap(u, v);
        update(id[top[u]], id[u], x);
        u = fa[top[u]];
    }
    if (dep[u] > dep[v])
        swap(u, v);
    update(id[u], id[v], x);
}
```
* å¯¹`u, v`ä¹‹é—´ç®€å•è·¯å¾„åšæ ‘ä¸Šå·®åˆ†çš„åšæ³•æ˜¯ `tag[u]++, tag[v]++, tag[lca]--, tag[fa[lca]]--`ã€‚

## å·®åˆ†çº¦æŸ
ç»™å‡ºä¸€ç»„åŒ…å«mä¸ªä¸ç­‰å¼ï¼Œnä¸ªæœªçŸ¥æ•°çš„ä¸ç­‰å¼ç»„

â€‹						å½¢å¦‚ï¼š$x_i$  - $x_j$ <= $y_k$

æ±‚æ»¡è¶³è¿™ä¸ªä¸ç­‰å¼ç»„çš„éè´Ÿè§£ï¼Œå¹¶ä¸”æ¯ä¸ªå˜é‡å°½é‡å°

n,m<=5e3,  -1e4<=y<=1e4

è¾“å‡ºnä¸ªæ•°ï¼Œè‹¥æ— è§£åˆ™è¾“å‡º-1

**æ— è§£åˆ¤æ–­**

å¯¹æ¯ä¸€ä¸ªsccï¼Œå¦‚æœå…¶ä¸­å…¨éƒ¨è¾¹è¾¹æƒéƒ½ä¸º0ï¼Œåˆ™æœ‰è§£ï¼Œå¦åˆ™æ— è§£

æœ‰è§£åå¯ä»¥é€šè¿‡ç¼©ç‚¹åŒ–ä¸ºdag

**æ±‚ä¸€ç»„è§£ï¼š**

o(n*m)

ç±»ä¼¼bellman-ford

```cpp
cin>>n>>m;
vector<array<int,3>>e;
for(int i=1;i<=m;i++){
	int l,r,w;cin>>l>>r>>w;
	e.push_back({l,r,w});
}
for(int i=0;i<=n;i++){
	for(auto [l,r,w]:e){
		x[l] = min(x[l],x[r]+w);
	}
}
for(auto [l,r,w]:e){
	if(x[l]>x[r]+w){
		cout<<-1<<endl;return;
	}
}
for(int i=1;i<=n;i++){
	cout<<x[i]<<" ";
}cout<<endl;
```

ä¸ºäº†**æ±‚éè´Ÿè§£**ï¼Œä»¤x[0]=0;

æ·»åŠ æ¡ä»¶ $x_0$ - $x_i$ <= 0  

```cpp
for(int i=1;i<=n;i++){
	e.push_back(0,i,0);
}
for(int i=1;i<=n;i++){
	x[i] = 1<<30;
}
```

é€šè¿‡è¿™æ ·æ±‚å‡ºæ¥çš„æ˜¯æ»¡è¶³æ¡ä»¶çš„**æœ€å¤§å€¼**

ä¸ºäº†**æ±‚æœ€å°å€¼**ï¼Œå¯ä»¥è½¬åŒ–ä¸ç­‰å¼ä¸º $x_j$ >= $x_i$ - w;

å­˜å‚¨éƒ¨åˆ†ä¸å˜

è¿­ä»£ä»£ç å˜ä¸ºï¼š

```cpp
for (int i=0;i<=n;i++){
	for(auto [l,r,w]:e){
		x[r] = max(x[r],x[l]-w);
	}
}
```

è¿­ä»£éƒ¨åˆ†ä¹Ÿå¯åˆ©ç”¨spfaæˆ–dijstraä¼˜åŒ–

ä¾‹ï¼š
#### é¢˜ç›®æè¿°

ç»™å‡ºä¸€ç»„åŒ…å« $m$ ä¸ªä¸ç­‰å¼ï¼Œæœ‰ $n$ ä¸ªæœªçŸ¥æ•°çš„å½¢å¦‚ï¼š

$$ \begin{cases} x_{c_1}-x_{c'_1}\leq y_1 \\x_{c_2}-x_{c'_2} \leq y_2 \\ \cdots\\ x_{c_m} - x_{c'_m}\leq y_m\end{cases}$$

çš„ä¸ç­‰å¼ç»„ï¼Œæ±‚ä»»æ„ä¸€ç»„æ»¡è¶³è¿™ä¸ªä¸ç­‰å¼ç»„çš„è§£ã€‚

#### è¾“å…¥æ ¼å¼

ç¬¬ä¸€è¡Œä¸ºä¸¤ä¸ªæ­£æ•´æ•° $n,m$ï¼Œä»£è¡¨æœªçŸ¥æ•°çš„æ•°é‡å’Œä¸ç­‰å¼çš„æ•°é‡ã€‚

æ¥ä¸‹æ¥ $m$ è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° $c,c',y$ï¼Œä»£è¡¨ä¸€ä¸ªä¸ç­‰å¼ $x_c-x_{c'}\leq y$ã€‚

#### è¾“å‡ºæ ¼å¼

ä¸€è¡Œï¼Œ$n$ ä¸ªæ•°ï¼Œè¡¨ç¤º $x_1 , x_2 \cdots x_n$ çš„ä¸€ç»„å¯è¡Œè§£ï¼Œå¦‚æœæœ‰å¤šç»„è§£ï¼Œè¯·è¾“å‡ºä»»æ„ä¸€ç»„ï¼Œæ— è§£è¯·è¾“å‡º `NO`ã€‚

#### æ ·ä¾‹ #1

##### æ ·ä¾‹è¾“å…¥ #1

```
3 3
1 2 3
2 3 -2
1 3 1
```

##### æ ·ä¾‹è¾“å‡º #1

```
5 3 5
```

**æ•°æ®èŒƒå›´**

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\leq n,m \leq 5\times 10^3$ï¼Œ$-10^4\leq y\leq 10^4$ï¼Œ$1\leq c,c'\leq n$ï¼Œ$c \neq c'$ã€‚

#### é¢˜è§£

```cpp
#include<bits/stdc++.h>
#define ll long long
#define endl '\n'
#define rep(i,a,b) for(ll i=a;i<=b;++i)
using namespace std;
#define int long long
// const ll maxn=10+1e5;
const long long mod = 998244353;

const int N = 5010;
const int M = 5010;
int n,m;
vector<array<int,3>>e;
int x[5010];
void solve()
{   
    cin>>n>>m;
    for(int i=1;i<=m;i++){
        int u,v,w;
        cin>>u>>v>>w;
        e.push_back({u,v,w});
    }
    for(int i=1;i<=n;i++){
        for(auto [u,v,w]:e){
            x[u] = min(x[u],x[v]+w);
        }
    }
    for(auto [u,v,w]:e){
        if(x[u]>x[v]+w){
            cout<<"NO"<<endl;return;
        }
    }
    for(int i=1;i<=n;i++){
        cout<<x[i]<<" ";
    }cout<<endl;
}

signed main(){
    ios::sync_with_stdio(0);
    cin.tie(0);
    cout.tie(0);

    ll T=1; 
    //cin>>T;
    while(T--){
        solve();
    }
}
```

## 2-sat
2-SATï¼Œç®€å•çš„è¯´å°±æ˜¯ç»™å‡ºnä¸ªé›†åˆï¼Œæ¯ä¸ªé›†åˆæœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œå·²çŸ¥è‹¥å¹²ä¸ª<a,b>ï¼Œè¡¨ç¤º aä¸bçŸ›ç›¾ï¼ˆå…¶ä¸­aä¸ bå±äºä¸åŒçš„é›†åˆï¼‰ã€‚ç„¶åä»æ¯ä¸ªé›†åˆé€‰æ‹©ä¸€ä¸ªå…ƒç´ ï¼Œåˆ¤æ–­èƒ½å¦ä¸€å…±é€‰ nä¸ªä¸¤ä¸¤ä¸çŸ›ç›¾çš„å…ƒç´ ã€‚æ˜¾ç„¶å¯èƒ½æœ‰å¤šç§é€‰æ‹©æ–¹æ¡ˆï¼Œä¸€èˆ¬é¢˜ä¸­åªéœ€è¦æ±‚å‡ºä¸€ç§å³å¯ã€‚

eg.[P4782 ã€æ¨¡æ¿ã€‘2-SAT - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)](https://www.luogu.com.cn/problem/P4782)

### ã€æ¨¡æ¿ã€‘2-SAT

#### é¢˜ç›®æè¿°

æœ‰ $n$ ä¸ªå¸ƒå°”å˜é‡ $x_1$$\sim$$x_n$ï¼Œå¦æœ‰ $m$ ä¸ªéœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶çš„å½¢å¼éƒ½æ˜¯ ã€Œ$x_i$ ä¸º `true` / `false` æˆ– $x_j$ ä¸º `true` / `false`ã€ã€‚æ¯”å¦‚ ã€Œ$x_1$ ä¸ºçœŸæˆ– $x_3$ ä¸ºå‡ã€ã€ã€Œ$x_7$ ä¸ºå‡æˆ– $x_2$ ä¸ºå‡ã€ã€‚

2-SAT é—®é¢˜çš„ç›®æ ‡æ˜¯ç»™æ¯ä¸ªå˜é‡èµ‹å€¼ä½¿å¾—æ‰€æœ‰æ¡ä»¶å¾—åˆ°æ»¡è¶³ã€‚

#### è¾“å…¥æ ¼å¼

ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° $n$ å’Œ $m$ï¼Œæ„ä¹‰å¦‚é¢˜é¢æ‰€è¿°ã€‚

æ¥ä¸‹æ¥ $m$ è¡Œæ¯è¡Œ $4$ ä¸ªæ•´æ•° $i$, $a$, $j$, $b$ï¼Œè¡¨ç¤º ã€Œ$x_i$ ä¸º $a$ æˆ– $x_j$ ä¸º $b$ã€($a, b\in \{0,1\}$)

#### è¾“å‡ºæ ¼å¼

å¦‚æ— è§£ï¼Œè¾“å‡º `IMPOSSIBLE`ï¼›å¦åˆ™è¾“å‡º `POSSIBLE`ã€‚

ä¸‹ä¸€è¡Œ $n$ ä¸ªæ•´æ•° $x_1\sim x_n$ï¼ˆ$x_i\in\{0,1\}$ï¼‰ï¼Œè¡¨ç¤ºæ„é€ å‡ºçš„è§£ã€‚

#### æ ·ä¾‹ #1

##### æ ·ä¾‹è¾“å…¥ #1

```
3 1
1 1 3 0
```

##### æ ·ä¾‹è¾“å‡º #1

```
POSSIBLE
0 0 0
```

#### æç¤º

$1\leq n, m\leq 10^6$ , å‰ $3$ ä¸ªç‚¹å¡å°é”™è¯¯ï¼Œåé¢ $5$ ä¸ªç‚¹å¡æ•ˆç‡ã€‚

ç”±äºæ•°æ®éšæœºç”Ÿæˆï¼Œå¯èƒ½ä¼šå«æœ‰ï¼ˆ 10 0 10 0ï¼‰ä¹‹ç±»çš„å‘ï¼Œä½†æŒ‰ç…§æœ€å¸¸è§„å†™æ³•çš„å†™çš„æ ‡ç¨‹æ²¡æœ‰å‡ºé”™ï¼Œå„ä¸ªæ•°æ®ç‚¹å¡ä»€ä¹ˆçš„æç¤ºåœ¨æ ‡ç¨‹é‡Œã€‚

#### æ€è·¯

å¯¹[i,a,j,b]

åŒ–æˆä¸¤æ¡è¾¹  $\lnot i \to j$  ã€   $\lnot j \to j$

 å¯¹å»ºå¥½çš„å›¾è·‘tarjan

è‹¥æœ€ç»ˆå­˜åœ¨  i  ä½¿å¾—  $\lnot i$å’Œiåœ¨åŒä¸€ä¸ªsccä¸­ï¼Œåˆ™æ— è§£ï¼Œå¦åˆ™å–æ‹“æ‰‘åºä¸­é åçš„å…ƒç´ 

#### é¢˜è§£

```cpp
#include<bits/stdc++.h>
#define ll long long
#define endl '\n'
#define rep(i,a,b) for(ll i=a;i<=b;++i)
using namespace std;
#define int long long
// const ll maxn=10+1e5;
const long long mod = 998244353;

const int N = 2000005;
const int M = 2000005;
vector<int>e[N];
int col[N],dfn[N],low[N],cnt;
int stk[N],top,_cnt;
vector<int>ans[N];

int n,m;
void Tarjan(int u){
	dfn[u]=low[u]=++cnt;
	stk[++top]=u;
	for(auto v:e[u]){
		if(!dfn[v]) Tarjan(v),low[u]=min(low[u],low[v]);
		else if(!col[v]) low[u]=min(low[u],dfn[v]);
	}
	if(low[u]==dfn[u]){
		col[u]=++_cnt;
		ans[_cnt].push_back(u);
		while(stk[top]!=u) 	
			ans[_cnt].push_back(stk[top]),col[stk[top--]]=_cnt;
		--top;
	}
}

void solve()
{   cin>>n>>m;
    for(int i=1;i<=m;i++){
        int u,a,v,b;cin>>u>>a>>v>>b;
        u--;v--;
        u=2*u+a;
        v=2*v+b;
        e[u^1].push_back(v);
        e[v^1].push_back(u);
    }
    for(int i=0;i<2*n;i++){
        if(!dfn[i]){
            Tarjan(i);
        }
    }
    for(int i=0;i<2*n;i+=2){
        if(col[i]==col[i^1]){
            cout<<"IMPOSSIBLE"<<endl;return;
        }
    }
    cout<<"POSSIBLE"<<endl;
    for(int i=0;i<2*n;i+=2){
        if(col[i]<col[i^1]){//æ­¤æ—¶éiæ‹“æ‰‘åºæ›´é å
            cout<<0<<" ";
        }
        else{
            cout<<1<<" ";
        }
    }
    cout<<endl;
}

signed main(){
    ios::sync_with_stdio(0);
    cin.tie(0);
    cout.tie(0);

    ll T=1; 
    //cin>>T;
    while(T--){
        solve();
    }
}
```

### [JSOI2010] æ»¡æ±‰å…¨å¸­

#### é¢˜ç›®æè¿°

æ»¡æ±‰å…¨å¸­æ˜¯ä¸­å›½æœ€ä¸°ç››çš„å®´å®¢èœè‚´ï¼Œæœ‰è®¸å¤šç§ä¸åŒçš„ææ–™é€è¿‡æ»¡æ—æˆ–æ˜¯æ±‰æ—çš„æ–™ç†æ–¹å¼ï¼Œå‘ˆç°åœ¨æ•°é‡ç¹å¤šçš„èœè‰²ä¹‹ä¸­ã€‚ç”±äºèœè‰²ä¼—å¤šè€Œç¹æ‚ï¼Œåªæœ‰æå°‘æ•°åšå­¦å¤šé—»æŠ€è‰ºé«˜è¶…çš„å¨å¸ˆèƒ½å¤Ÿåšå‡ºæ»¡æ±‰å…¨å¸­ï¼Œè€Œèƒ½å¤Ÿçƒ¹é¥ªå‡ºç»è¿‡ä¸“å®¶è®¤è¯çš„æ»¡æ±‰å…¨å¸­ï¼Œä¹Ÿæ˜¯ä¸­å›½å¨å¸ˆæœ€å¤§çš„è£èª‰ä¹‹ä¸€ã€‚ä¸–ç•Œæ»¡æ±‰å…¨å¸­åä¼šæ˜¯ç”±èƒ½å¤Ÿæ–™ç†æ»¡æ±‰å…¨å¸­çš„ä¸“å®¶å¨å¸ˆä»¬æ‰€ç»„æˆï¼Œè€Œä»–ä»¬ä¹‹é—´è¿˜ç»†åˆ†ä¸ºè®¸å¤šä¸åŒç­‰çº§çš„å¨å¸ˆã€‚

ä¸ºäº†æ‹›æ”¶æ–°è¿›çš„å¨å¸ˆè¿›å…¥ä¸–ç•Œæ»¡æ±‰å…¨å¸­åä¼šï¼Œå°†äºè¿‘æ—¥ä¸¾åŠæ»¡æ±‰å…¨å¸­å¤§èµ›ï¼Œåä¼šæ´¾é£è®¸å¤šä¼šå‘˜å½“ä½œè¯„å®¡å‘˜ï¼Œä¸ºçš„å°±æ˜¯è¦åœ¨å‚èµ›çš„å¨å¸ˆä¹‹ä¸­ï¼Œæ‰¾åˆ°æ»¡æ±‰ç•Œçš„æ˜æ—¥ä¹‹æ˜Ÿã€‚

å¤§ä¼šçš„è§„åˆ™å¦‚ä¸‹ï¼šæ¯ä½å‚èµ›çš„é€‰æ‰‹å¯ä»¥å¾—åˆ° $n$ ç§æï¦¾ï¼Œé€‰æ‰‹å¯ä»¥è‡ªç”±é€‰æ‹©ç”¨æ»¡å¼æˆ–æ˜¯æ±‰å¼æ–™ç†å°†ææ–™å½“æˆèœè‚´ã€‚

å¤§ä¼šçš„è¯„å®¡åˆ¶åº¦æ˜¯ï¼šå…±æœ‰ $m$ ä½è¯„å®¡å‘˜åˆ†åˆ«æŠŠå…³ã€‚æ¯ä¸€ä½è¯„å®¡å‘˜å¯¹äºæ»¡æ±‰å…¨å¸­æœ‰å„è‡ªç‹¬ç‰¹çš„è§è§£ï¼Œä½†åŸºæœ¬è§è§£æ˜¯ï¼Œè¦æœ‰ä¸¤æ ·èœè‰²ä½œä¸ºæ»¡æ±‰å…¨å¸­çš„æ ‡å¿—ã€‚å¦‚æŸè¯„å®¡è®¤ä¸ºï¼Œå¦‚æœæ²¡æœ‰æ±‰å¼ä¸œå¡è‚‰è·Ÿæ»¡å¼çš„æ¶®ç¾Šè‚‰é”…ï¼Œå°±ä¸èƒ½ç®—æ˜¯æ»¡æ±‰å…¨å¸­ã€‚ä½†é¿å…è¿‡äºæœ‰ä¸»è§çš„å®¡æ ¸ï¼Œå¤§ä¼šè§„å®šä¸€ä¸ªè¯„å®¡å‘˜é™¤éæ˜¯åœ¨è®¤ä¸ºå¿…å¤‡çš„ä¸¤æ ·èœè‰²éƒ½æ²¡æœ‰åšå‡ºæ¥çš„çŠ¶å†µä¸‹ï¼Œæ‰èƒ½æ·˜æ±°ä¸€ä½é€‰æ‰‹ï¼Œå¦åˆ™ä¸èƒ½æ·˜æ±°ä¸€ä½é€‰æ‰‹ã€‚

æ¢ï¤†è¯è¯´ï¼Œåªè¦å‚èµ›è€…èƒ½åœ¨è¿™ä¸¤ç§ææ–™çš„åšæ³•ä¸­ï¼Œå…¶ä¸­ä¸€ä¸ªç¬¦åˆè¯„å®¡çš„å–œå¥½å³å¯é€šè¿‡è¯¥è¯„å®¡çš„å®¡æŸ¥ã€‚å¦‚æï¦¾æœ‰çŒªè‚‰ï¼Œç¾Šè‚‰å’Œç‰›è‚‰æ—¶ï¼Œæœ‰å››ä½è¯„å®¡å‘˜çš„å–œå¥½å¦‚ä¸‹è¡¨ï¼š 

```
è¯„å®¡ä¸€ è¯„å®¡äºŒ è¯„å®¡ä¸‰ è¯„å®¡å›› 
æ»¡å¼ç‰›è‚‰ æ»¡å¼çŒªè‚‰ æ±‰å¼ç‰›è‚‰ æ±‰å¼ç‰›è‚‰ 
æ±‰å¼çŒªè‚‰ æ»¡å¼ç¾Šè‚‰ æ±‰å¼çŒªè‚‰ æ»¡å¼ç¾Šè‚‰ 
```

å¦‚å‚èµ›è€…ç”²åšå‡ºæ»¡å¼çŒªè‚‰ï¼Œæ»¡å¼ç¾Šè‚‰å’Œæ»¡å¼ç‰›è‚‰æ–™ç†ï¼Œä»–å°†æ— æ³•æ»¡è¶³è¯„å®¡ä¸‰çš„è¦æ±‚ï¼Œæ— æ³•é€šè¿‡è¯„å®¡ã€‚è€Œå‚èµ›è€…ä¹™åšå‡ºæ±‰å¼çŒªè‚‰ï¼Œæ»¡å¼ç¾Šè‚‰å’Œæ»¡å¼ç‰›è‚‰æ–™ç†ï¼Œå°±å¯ä»¥æ»¡è¶³æ‰€æœ‰è¯„å®¡çš„è¦æ±‚ã€‚

ä½†å¤§ä¼šåæ¥å‘ç°ï¼Œåœ¨è¿™æ ·çš„åˆ¶åº¦ä¸‹å¦‚æœææ–™é€‰æ‹©è·Ÿæ´¾å‡ºçš„è¯„å®¡å‘˜æ²¡æœ‰ç‰¹åˆ«å®‰æ’å¥½çš„è¯ï¼Œæ‰€æœ‰çš„å‚èµ›è€…æœ€å¤šåªèƒ½é€šè¿‡éƒ¨åˆ†è¯„å®¡å‘˜çš„å®¡æŸ¥è€Œï¥§æ˜¯å…¨éƒ¨ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‘ç”Ÿæ²¡æœ‰äººé€šè¿‡è€ƒæ ¸çš„æƒ…å½¢ã€‚

å¦‚æœ‰å››ä¸ªè¯„å®¡å‘˜å–œå¥½å¦‚ä¸‹è¡¨æ—¶ï¼Œåˆ™ä¸è®ºå‚èµ›è€…é‡‡å–ä»€ä¹ˆæ ·çš„åšæ³•ï¼Œéƒ½ä¸å¯èƒ½é€šè¿‡æ‰€æœ‰è¯„å®¡çš„è€ƒæ ¸ï¼š 

```
è¯„å®¡ä¸€ è¯„å®¡äºŒ è¯„å®¡ä¸‰ è¯„å®¡å›› 
æ»¡å¼ç¾Šè‚‰ æ»¡å¼çŒªè‚‰ æ±‰å¼ç¾Šè‚‰ æ±‰å¼ç¾Šè‚‰ 
æ±‰å¼çŒªè‚‰ æ»¡å¼ç¾Šè‚‰ æ±‰å¼çŒªè‚‰ æ»¡å¼çŒªè‚‰ 
```

æ‰€ä»¥å¤§ä¼šå¸Œæœ›æœ‰äººèƒ½å†™ä¸€ä¸ªç¨‹åºæ¥åˆ¤æ–­ï¼Œæ‰€é€‰å‡ºçš„ $m$ ä½è¯„å®¡ï¼Œä¼šä¸ä¼šå‘ç”Ÿæ²¡æœ‰äººèƒ½é€šè¿‡è€ƒæ ¸çš„çª˜å¢ƒï¼Œä»¥ä¾¿åä¼šç»„ç»‡åˆé€‚çš„è¯„å®¡å›¢ã€‚

#### è¾“å…¥æ ¼å¼

ç¬¬ä¸€ï¨ˆåŒ…å«ä¸€ä¸ªæ•°å­— $K$ï¼ˆ$1\le K \le 50$ï¼‰ï¼Œä»£è¡¨æµ‹è¯•æ–‡ä»¶åŒ…å«äº† $K$ ç»„æ•°æ®ã€‚

æ¯ä¸€ç»„æµ‹è¯•æ•°æ®çš„ç¬¬ä¸€ï¨ˆåŒ…å«ä¸¤ä¸ªæ•°å­— $n$ è·Ÿ $m$ï¼ˆ$nâ‰¤100$ï¼Œ$mâ‰¤1000$ï¼‰ï¼Œä»£è¡¨æœ‰ $n$ ç§ææ–™ï¼Œ$m$ ä½è¯„å®¡å‘˜ã€‚

ä¸ºæ–¹ï¥¥èµ·è§ï¼Œèˆå¼ƒåšæ³•çš„ä¸­æ–‡åç§°è€Œç»™äºˆç¼–å·ï¼Œç¼–å·åˆ†åˆ«ä» $1$ åˆ° $n$ã€‚

æ¥ä¸‹æ¥çš„ $m$ è¡Œï¼Œæ¯è¡Œéƒ½ä»£è¡¨å¯¹åº”çš„è¯„å®¡å‘˜æ‰€æ‹¥æœ‰çš„ä¸¤ä¸ªå–œå¥½ï¼Œæ¯ä¸ªå–œå¥½ç”±ä¸€ä¸ªè‹±æ–‡å­—æ¯è·Ÿä¸€ä¸ªæ•°å­—ä»£è¡¨ï¼Œå¦‚ $m1$ ä»£è¡¨è¿™ä¸ªè¯„å®¡å–œæ¬¢ç¬¬ $1$ ä¸ªæï¦¾é€è¿‡æ»¡å¼æ–™ç†åšå‡ºæ¥çš„èœï¼Œè€Œ $h2$ ä»£è¡¨è¿™ä¸ªè¯„å®¡å‘˜å–œæ¬¢ç¬¬ $2$ ä¸ªææ–™é€è¿‡æ±‰å¼æ–™ç†åšå‡ºæ¥çš„èœã€‚

#### è¾“å‡ºæ ¼å¼

æ¯ç»„æµ‹è¯•æ•°æ®è¾“å‡ºä¸€è¡Œï¼Œå¦‚æœä¸ä¼šå‘ç”Ÿæ²¡æœ‰äººèƒ½é€šè¿‡è€ƒæ ¸çš„çª˜å¢ƒï¼Œè¾“å‡º ```GOOD```ï¼›å¦åˆ™è¾“å‡º ```BAD```ï¼ˆå‡ä¸ºå¤§å†™å­—æ¯ï¼‰ã€‚

#### æ ·ä¾‹ #1

##### æ ·ä¾‹è¾“å…¥ #1

```
2
3 4
m3 h1
m1 m2
h1 h3
h3 m2
2 4
h1 m2
m2 m1
h1 h2
m1 h2
```

##### æ ·ä¾‹è¾“å‡º #1

```
GOOD
BAD
```

#### é¢˜è§£

``` cpp
#include<bits/stdc++.h>
#define ll long long
#define endl '\n'
#define rep(i,a,b) for(ll i=a;i<=b;++i)
using namespace std;
#define int long long
// const ll maxn=10+1e5;
const long long mod = 998244353;

const int N = 2010;
const int M = 2010;
vector<int>e[N];
int col[N],dfn[N],low[N],cnt;
int stk[N],top,_cnt;
vector<int>ans[N];

int n,m;
void Tarjan(int u){
	dfn[u]=low[u]=++cnt;
	stk[++top]=u;
	for(auto v:e[u]){
		if(!dfn[v]) Tarjan(v),low[u]=min(low[u],low[v]);
		else if(!col[v]) low[u]=min(low[u],dfn[v]);
	}
	if(low[u]==dfn[u]){
		col[u]=++_cnt;
		ans[_cnt].push_back(u);
		while(stk[top]!=u) 	
			ans[_cnt].push_back(stk[top]),col[stk[top--]]=_cnt;
		--top;
	}
}

void solve()
{   cin>>n>>m;
    cnt=0;_cnt=0;top=0;
    for(int i=0;i<2*n;i++){
        e[i].clear();
        dfn[i]=0;
        low[i]=0;
        col[i]=0;
        ans[i].clear();
    }
    for(int i=1;i<=m;i++){
        char x,y;int u,v;
        cin>>x;
        cin>>u;
        cin>>y;
        cin>>v;
        u--;v--;//0 - n-1
        //cout<<u<<"  "<<v<<endl;
        u = 2*u+(x=='m');
        v = 2*v+(y=='m');

        e[u^1].push_back(v);
        e[v^1].push_back(u);
    }

    for(int i=0;i<2*n;i++){
        if(!dfn[i]){
            Tarjan(i);
        }
    }
    for(int i=0;i<2*n;i+=2){
        if(col[i]==col[i^1]){
            cout<<"BAD"<<endl;
            return;
        }
    }
    cout<<"GOOD"<<endl;
    return;
}

signed main(){
    ios::sync_with_stdio(0);
    cin.tie(0);
    cout.tie(0);

    ll T=1; 
    cin>>T;
    while(T--){
        solve();
    }
}
```
