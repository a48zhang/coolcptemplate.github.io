
# 5-å›¾è®º


---

## æœ€çŸ­è·¯

## dijkstra

```cpp
#include <bits/stdc++.h>
using namespace std;
#define ll long long
const ll maxn = 10+1e5;
const ll inf = 0x3f3f3f3f;
typedef pair<ll,ll> pll;
    vector<pll> mp[100100];
    ll n,m,s;
    ll dis[100100];
    ll vis[100100];

void dij(ll s){
    for(ll i=1;i<=n;i++){
        dis[i]=inf;
    }
    dis[s]=0;
    priority_queue<pll,vector<pll>,greater<pll> > q;
    q.push({dis[s],s});
    while(!q.empty()){
        ll u=q.top().second;
        q.pop();
        if(vis[u]) continue;
        vis[u]=1;
        for(auto [w,v]:mp[u]){
            if(dis[u]+w<dis[v]){
                dis[v]=dis[u]+w;
                q.push({dis[v],v});
            }
        }
    }
}
int main() {
	cin>>n>>m>>s;
	for(ll i=1;i<=m;i++){
    	ll u,v,w;
    	cin>>u>>v>>w;
    	mp[u].push_back({w,v});
	}
	dij(s);
	for(ll i=1;i<=n;i++)
        cout<<dis[i]<<" ";
    return 0;
}
```

## å¹¶æŸ¥é›†

> å·²ç§»è‡³æ•°æ®ç»“æ„éƒ¨åˆ†

## æœ€å°ç”Ÿæˆæ ‘

### prim O(n^2)

```cpp
    vector<pll> edge[maxn];
    ll dis[maxn];
    ll vis[maxn];
void update(ll u){
    for(auto [v,w]:edge[u]){
        dis[v]=min(dis[v],w);
    }

}
ll prim(ll n){
    for(ll i=1;i<=n;i++){
        vis[i]=0;
        dis[i]=inf;
    }
    vis[1]=1;
    update(1);
    ll ans=0;
    for(ll i=1;i<=n-1;i++){//è¿æ¥n-1æ¡è¾¹
        ll pos,mi=inf;
        for(ll j=1;j<=n;j++){
            if(vis[j]) continue;
            if(dis[j]<mi){
                mi=dis[j];
                pos=j;
            }
        }
        ans+=mi;
        vis[pos]=1;
        update(pos);    
    }
    return ans;
}
```

### prim O(mlogm) (å°æ ¹å †ä¼˜åŒ–)
```cpp
    vector<pll> edge[maxn];
    ll dis[maxn];
    ll vis[maxn];
ll prim(ll n){
    for(ll i=1;i<=n;i++){
        vis[i]=0;
        dis[i]=inf;
    }
    ll ans=0;
    priority_queue<pll,vector<pll>,greater<pll>> pq;
    pq.push({0,1});
    while(!pq.empty()){
        auto [d,u]=pq.top();
        pq.pop();
        if(vis[u]) continue;
        vis[u]=1;
        ans+=d;
        for(auto [v,w]:edge[u]){
            if(!vis[v]&&w<dis[v]){
                dis[v]=w;
                pq.push({dis[v],v});
            }
        }
    }
    return ans;
}
```

### kruskal

```cpp
typedef struct{
    ll u,v,w;
}eg;
    eg e[maxm];
    vector<pll> edge[maxn];
    ll fa[maxn];
bool cmp(eg a,eg b){
    return a.w<b.w;
}
ll find(ll a){
    return (fa[a]==a)?a:(fa[a]=find(fa[a]));
}
void merge(ll a,ll b){
    fa[a]=b;
}
ll kruscal(ll n,ll m){
    for(ll i=1;i<=n;i++){
        fa[i]=i;
    }
    sort(e+1,e+m+1,cmp);
    ll ans=0;
    for(ll i=1;i<=m;i++){
        ll a=find(e[i].u);
        ll b=find(e[i].v);
        if(a!=b){
            merge(a,b);
            ans+=e[i].w;
            n--;
        }
    }
    if(n==1){
        return ans;
    }else{
        return inf;
    }
}
for(ll i=1;i<=m;i++){
    ll u,v,w;
    cin>>u>>v>>w;
    edge[u].push_back({v,w});
    edge[v].push_back({u,w});
    e[i].u=u;e[i].v=v;e[i].w=w;
}
```

## åŸºäºå€å¢çš„LCA

```cpp
#include <bits/stdc++.h>
using namespace std;
#define IOS ios::sync_with_stdio(false),cin.tie(nullptr), cout.tie(nullptr);
#define ll long long
#define ull unint long long
#define lowbit(i) ((i) & (-i))
#define ls(p) (p << 1)
#define rs(p) (p << 1 | 1)
#define rep(i, a, b) for (ll i = a; i <= b; i++)
#define per(i, a, b) for (ll i = a; i >= b; i--)

typedef pair<ll, ll> pll;
const ll mod = 1e9 + 7;
const ll inf = 0x3f3f3f3f;
const ll maxn = 5e5 + 200;

    ll n, q, root; 
    vector<ll> mp[N];
    ll lg2[maxn];
    ll dep[maxn];
    ll f[maxn][20];
    ll vis[maxn];
void dfs(ll u, ll fa = 0){
    if (vis[u]) return;
    vis[u] = 1;
    dep[u] = dep[fa] + 1;
    f[u][0] = fa;
    for (ll i = 1; i <= lg2[dep[u]]; i++){
        f[u][i] = f[f[u][i - 1]][i - 1];
    }
    for (auto v : mp[u]){
        dfs(v, u);
    }
}
ll lca(ll a, ll b){
    if (dep[a] > dep[b])
        swap(a, b);
    while (dep[a] != dep[b])
        b = f[b][lg2[dep[b] - dep[a]]];
    if (a == b)
        return a;
    for (ll k = lg2[dep[a]]; k >= 0; k--){
        if (f[a][k] != f[b][k]){
            a = f[a][k], b = f[b][k];
        }
    }
    return f[a][0];
}
int main(){
    IOS 
    cin >> n >> q >> root;
    for (ll i = 1; i < n; i++){
        ll u, v;
        cin >> u >> v;
        mp[u].push_back(v);
        mp[v].push_back(u);
    }
    for (ll i = 2; i <= n; i++){
        lg2[i] = lg2[i / 2] + 1;
    }
    dfs(root);
    while (q--){
        ll u, v;
        cin >> u >> v;
        cout << lca(u, v) << endl;
    }
    return 0;
}
```

## æœ‰å‘å›¾å¼ºè”é€šåˆ†é‡

æœ‰å‘éå¼ºè¿é€šå›¾ä¸­çš„**æå¤§**å¼ºè¿é€šå­å›¾æˆ‘ä»¬ç§°ä¸º**å¼ºè¿é€šåˆ†é‡**

å¦‚æœä¸€ä¸ªæœ‰å‘å›¾ä¸æ˜¯å¼ºè¿é€šå›¾ä½†æ˜¯å°†**æ‰€æœ‰æœ‰å‘è¾¹æ¢æˆæ— å‘è¾¹**å˜æˆäº†å¼ºè¿é€šå›¾ï¼Œé‚£ä¹ˆè¯¥å›¾å°±æ˜¯**å¼±è¿é€šå›¾**ã€‚

Kosarajuç®—æ³•

é¦–å…ˆå¯¹åŸå›¾$G$è¿›è¡Œéå†ï¼Œè®°å½•èŠ‚ç‚¹è®¿é—®**å®Œ**çš„é¡ºåº$d_i$ï¼Œ$d_i$ è¡¨ç¤ºç¬¬$i$ä¸ªè®¿é—®å®Œçš„èŠ‚ç‚¹ç¼–å·ã€‚

æˆ‘ä»¬é€‰æ‹©æœ€æ™š**è®¿é—®å®Œ**çš„èŠ‚ç‚¹ï¼Œå¯¹$G$çš„åå‘å›¾è¿›è¡Œéå†ï¼Œå®ƒèƒ½å¤Ÿéå†åˆ°çš„é¡¶ç‚¹å’Œå®ƒç»„æˆäº†ä¸€ä¸ª SCCï¼ŒæŠŠè¯¥è¿‡ç¨‹æ‰€éå†åˆ°çš„èŠ‚ç‚¹æ‰“æ ‡è®°ï¼Œæ¥ä¸‹æ¥ç»§ç»­æ‰¾æœ€æ™š**è®¿é—®å®Œ**ä¸”æœªè¢«æ‰“ä¸Šæ ‡è®°çš„èŠ‚ç‚¹è¿›è¡Œéå†æ“ä½œã€‚

```cpp
#include <bits/stdc++.h>
#define ll long long
using namespace std;
const int Maxn=1e5+7;
int n,m;
vector<int>e[Maxn],e1[Maxn];
// e å­˜æ­£å‘è¾¹,e1 å­˜åå‘è¾¹ 
bool vis[Maxn];
int d[Maxn],cnt,col[Maxn],cnt1;
void dfs1(int u){
	vis[u]=1;
	for(auto v:e[u]) if(!vis[v]) dfs1(v);
	d[++cnt]=u;
}
vector<int>ans[Maxn];
void dfs2(int u){
	col[u]=cnt1;
	ans[cnt1].push_back(u);
	for(auto v:e1[u]) if(!col[v]) dfs2(v);
}
int main(){
	scanf("%d%d",&n,&m);
	for(int i=1,u,v;i<=m;i++){
		scanf("%d%d",&u,&v);
		e[u].push_back(v);
		e1[v].push_back(u);
	}
	for(int i=1;i<=n;i++) if(!vis[i]) dfs1(i);
	for(int i=n;i;i--) if(!col[d[i]]) ++cnt1,dfs2(d[i]);
	for(int i=1;i<=cnt1;i++) sort(ans[i].begin(),ans[i].end());
	printf("%d\n",cnt1);
	for(int i=1;i<=n;i++){
		if(ans[col[i]].size()){
			for(auto j:ans[col[i]]) printf("%d ",j);
			puts("");
			ans[col[i]].resize(0);
		}
	}
	return 0;
}
```

Tarjanç®—æ³•

åœ¨ DFS è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å¦‚ä¸‹ 4 ç§è¾¹ï¼š

- æ ‘æè¾¹ï¼šDFS è¿‡ç¨‹ä¸­ç»è¿‡çš„è¾¹ï¼Œå³ DFS æœç´¢æ ‘ä¸Šçš„è¾¹ã€‚

- å‰å‘è¾¹ï¼šä»ç¥–å…ˆèŠ‚ç‚¹æŒ‡å‘åä»£èŠ‚ç‚¹çš„éæ ‘æè¾¹ï¼Œæˆ‘ä»¬ç§°ä¸ºå‰å‘è¾¹ã€‚

- è¿”ç¥–è¾¹ï¼ˆåå‘è¾¹ï¼‰ï¼šä»åä»£èŠ‚ç‚¹æŒ‡å‘ç¥–å…ˆèŠ‚ç‚¹çš„éæ ‘æè¾¹ï¼Œæˆ‘ä»¬ç§°ä¸ºè¿”ç¥–è¾¹ï¼ˆåå‘è¾¹ï¼‰ã€‚

- æ¨ªå‰è¾¹ï¼šä¸¤ç«¯æ— ç¥–å…ˆå…³ç³»çš„éæ ‘æè¾¹ï¼Œæˆ‘ä»¬ç§°ä¸ºæ¨ªå‰è¾¹ã€‚

  æ¯ä¸ªå¼ºè¿é€šåˆ†é‡éƒ½æ˜¯ DFS æ ‘çš„ä¸€é¢—å­æ ‘ï¼Œæœç´¢æ—¶ï¼ŒæŠŠå½“å‰ DFS æ ‘ç§æœªå¤„ç†çš„èŠ‚ç‚¹åŠ å…¥ä¸€ä¸ªæ ˆï¼Œå›æº¯æ—¶å¯ä»¥åˆ¤æ–­æ ˆé¡¶åˆ°æ ˆä¸­çš„èŠ‚ç‚¹æ˜¯å¦æ„æˆä¸€ä¸ªå¼ºè¿é€šåˆ†é‡ã€‚

æˆ‘ä»¬ä¸å¦¨å®šä¹‰$dfn(u)$è¡¨ç¤ºèŠ‚ç‚¹$u$åœ¨ DFS ä¸­çš„éå†ç¼–å·ï¼ˆ**æ—¶é—´æˆ³**ï¼‰ï¼Œ$low(u)$è¡¨ç¤º$u$æˆ–$u$çš„å­æ ‘èƒ½å¤Ÿæœ€å¤šåªé€šè¿‡**ä¸€æ¡éæ ‘æè¾¹ï¼ˆä¸åŒ…å«æ ‘è¾¹ï¼‰**å›æº¯çš„æœ€æ—©çš„$dfn$å€¼ï¼Œç”¨ä¸€ä¸ªæ ˆè®°å½•ç»è¿‡çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š

- åˆå§‹æƒ…å†µæœ‰$low(u)=dfn(u)$ã€‚
- å¯¹äºè¾¹$(u,v)$ ï¼Œå¦‚æœ$u$ä¸º$v$çš„çˆ¶äº²èŠ‚ç‚¹ï¼Œåˆ™æœ‰$low(u)=min(low(u),low(v))$ã€‚
- å¯¹äºè¾¹$(u,v)$ä¸ºè¿”ç¥–è¾¹æˆ–è€…æŒ‡å‘éå…¶ä»–å¼ºè¿é€šçš„æ¨ªå‰è¾¹ï¼Œåˆ™æœ‰$low(u)=min(low(u),dfn(v))$ã€‚

åœ¨èŠ‚ç‚¹$u$æœç´¢å®Œæ¯•ä¹‹åï¼Œå¦‚æœ$low(u)=dfn(u)$ï¼Œé‚£ä¹ˆè¯´æ˜ä»¥$u$ä¸º**æ ¹èŠ‚ç‚¹**çš„æœç´¢å­æ ‘ä¸ŠåŠæ ˆä¸­åœ¨$u$å†…çš„å…ƒç´ ç»„æˆäº†ä¸€ä¸ªå¼ºè¿é€šåˆ†é‡ï¼Œç„¶ååˆ é™¤æ ˆå†…çš„è¿™äº›å…ƒç´ ï¼Œä¸æ–­é‡å¤è¯¥æ“ä½œç›´åˆ°æ‰¾åˆ°æ‰€æœ‰çš„å¼ºè¿é€šåˆ†é‡ã€‚

ä¾‹ [P3387 ã€æ¨¡æ¿ã€‘ç¼©ç‚¹ - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)](https://www.luogu.com.cn/problem/P3387)

```cpp
#include <bits/stdc++.h>
#define ll long long
using namespace std;
const int Maxn=1e5+7;
int n,m;
vector<int>e[Maxn];
int col[Maxn],dfn[Maxn],low[Maxn],cnt;
int stk[Maxn],top,_cnt;
vector<int>ans[Maxn];
void Tarjan(int u){
	dfn[u]=low[u]=++cnt;
	stk[++top]=u;
	for(auto v:e[u]){
		if(!dfn[v]) Tarjan(v),low[u]=min(low[u],low[v]);
		else if(!col[v]) low[u]=min(low[u],dfn[v]);
	}
	if(low[u]==dfn[u]){
		col[u]=++_cnt;
		ans[_cnt].push_back(u);
		while(stk[top]!=u) 	
			ans[_cnt].push_back(stk[top]),col[stk[top--]]=_cnt;
		--top;
	}
}
int main(){
	scanf("%d%d",&n,&m);
	for(int i=1,u,v;i<=m;i++){
		scanf("%d%d",&u,&v);
		e[u].push_back(v);
	}
	for(int i=1;i<=n;i++) if(!dfn[i]) Tarjan(i);
	for(int i=1;i<=_cnt;i++) sort(ans[i].begin(),ans[i].end());
	printf("%d\n",_cnt);
	for(int i=1;i<=n;i++){
		if(ans[col[i]].size()){
			for(auto j:ans[col[i]]) printf("%d ",j);
			puts("");
			ans[col[i]].resize(0);
		}
	}
	return 0;
}
```

## å‰²ç‚¹å‰²è¾¹

- å‰²ç‚¹ï¼šåœ¨**æ— å‘å›¾**ä¸­ï¼Œåˆ å»è¯¥ç‚¹åä½¿å¾—è¿é€šå—æ•°å¢åŠ çš„ç»“ç‚¹ç§°ä¸º **å‰²ç‚¹**ã€‚
- å‰²è¾¹ï¼ˆæ¡¥ï¼‰ï¼šåœ¨**æ— å‘å›¾**ä¸­ï¼Œåˆ å»è¯¥è¾¹åä½¿å¾—è¿é€šå—æ•°å¢åŠ çš„è¾¹ç§°ä¸º **å‰²è¾¹ï¼ˆæ¡¥ï¼‰**ã€‚

ä¸€ä¸ªå›¾å¯èƒ½ä¼šæœ‰å¤šä¸ªå‰²ç‚¹æˆ–è€…å‰²è¾¹ï¼Œä½†æ˜¯æœ‰å‰²ç‚¹çš„å›¾ä¸ä¸€å®šå­˜åœ¨å‰²è¾¹ï¼Œæœ‰å‰²è¾¹çš„å›¾ä¸ä¸€å®šå­˜åœ¨å‰²ç‚¹ã€‚



### å‰²ç‚¹

å’Œæœ‰å‘å›¾æ±‚ SCC ä¸€æ ·ï¼Œæˆ‘ä»¬ä¼šåœ¨æœç´¢è¿‡ç¨‹ä¸­é‡åˆ°ä¸¤ç§æœç´¢æ ‘ä¸Šçš„è¾¹ï¼š

- æ ‘æè¾¹ï¼šDFS è¿‡ç¨‹ä¸­ç»è¿‡çš„è¾¹ï¼Œå³ DFS æœç´¢æ ‘ä¸Šçš„è¾¹ã€‚
- è¿”ç¥–è¾¹ï¼ˆåå‘è¾¹ï¼‰ï¼šä»åä»£èŠ‚ç‚¹æŒ‡å‘ç¥–å…ˆèŠ‚ç‚¹çš„éæ ‘æè¾¹ï¼Œæˆ‘ä»¬ç§°ä¸ºè¿”ç¥–è¾¹ï¼ˆåå‘è¾¹ï¼‰ã€‚

ä¸åŒ…å«æ¨ªå‰è¾¹å’Œå‰å‘è¾¹ï¼Œå› ä¸ºè¿™æ˜¯**æ— å‘å›¾**ã€‚

æˆ‘ä»¬ä¸å¦¨å®šä¹‰$dfn(u)$è¡¨ç¤ºèŠ‚ç‚¹$u$åœ¨ DFS ä¸­çš„éå†ç¼–å·ï¼ˆ**æ—¶é—´æˆ³**ï¼‰ï¼Œ$low(u)$ è¡¨ç¤º$u$æˆ–$u$çš„å­æ ‘èƒ½å¤Ÿæœ€å¤šåªé€šè¿‡**ä¸€æ¡éæ ‘æè¾¹ï¼ˆä¸åŒ…å«æ ‘è¾¹ï¼‰**å›æº¯çš„æœ€æ—©çš„$dfn$å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š

- åˆå§‹æƒ…å†µæœ‰$low(u)=dfn(u)$ã€‚
- å¯¹äºè¾¹$(u,v)$ï¼Œå¦‚æœ$v$æ²¡æœ‰è¢«æœç´¢åˆ°ï¼Œé‚£ä¹ˆè¿™æ¡è¾¹å°±æ˜¯æ ‘æè¾¹ï¼Œåˆ™æœ‰$low(u)=min(low(u),low(v))$ã€‚
- å¯¹äºè¾¹$(u,v)$ï¼Œå¦‚æœ$v$è¢«æœç´¢åˆ°äº†ï¼Œé‚£ä¹ˆè¿™æ¡è¾¹å°±æ˜¯è¿”ç¥–è¾¹ï¼Œåˆ™æœ‰$low(u)=min(low(u),dfn(v))$ã€‚

å¯¹äºä¸€ä¸ªèŠ‚ç‚¹$uâ€‹$ï¼Œå®ƒçš„å­èŠ‚ç‚¹$vâ€‹$ï¼Œè‹¥$low(v)\geq dfn(u)â€‹$ï¼Œè¯´æ˜$vâ€‹$æ— æ³•é€šè¿‡å®ƒå­æ ‘çš„èŠ‚ç‚¹åˆ°è¾¾$dfnâ€‹$æ›´å°çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯$vâ€‹$æ— æ³•ä¸ç»è¿‡ç‚¹$uâ€‹$åˆ°è¾¾æ¯”$uâ€‹$çš„$dfnâ€‹$å€¼æ›´å°çš„èŠ‚ç‚¹ï¼Œæ˜¾ç„¶$uâ€‹$æ˜¯ä¸€ä¸ªå‰²ç‚¹ï¼Œåä¹‹ ğ‘¢ $uâ€‹$å°±ä¸æ˜¯ä¸€ä¸ªå‰²ç‚¹ã€‚

ä½†æ˜¯å¯¹äºæ ¹èŠ‚ç‚¹$u$ï¼Œå®ƒçš„$dfn$å€¼ä¸€å®šæ˜¯æ•´ä¸ªåºåˆ—çš„æœ€å°å€¼ï¼Œå› æ­¤ä¸Šè¿°æ–¹æ³•ä¸ç®¡ç”¨ï¼Œå¦‚æœå®ƒå­˜åœ¨ä¸¤ä¸ªåŠä»¥ä¸Šçš„å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæŠŠ$u$åˆ é™¤åç»å¯¹ä¼šæŠŠ$u$å­èŠ‚ç‚¹çš„å­æ ‘åˆ†å‰²å¼€æ¥ï¼Œæ­¤æ—¶$u$æ˜¯å‰²ç‚¹ã€‚

```cpp
#include <bits/stdc++.h>
#define ll long long
using namespace std;
const ll Maxn=1e5+7;
struct edge1{
	ll v,Next;
}Edge[Maxn<<1];
ll n,m,tot,low[Maxn],dfn[Maxn],cnt,root,ans,head[Maxn];
bool flg[Maxn];
inline void add(ll u,ll v){
	Edge[++tot]=(edge1){v,head[u]},head[u]=tot;
}
void tarjan(ll u){
	dfn[u]=low[u]=++cnt;
	ll ch=0;
	for(ll i=head[u];i;i=Edge[i].Next){
		ll v=Edge[i].v;
		if(!dfn[v]){
			ch++;
			tarjan(v);
			low[u]=min(low[u],low[v]);
			if(low[v]>=dfn[u]&&u!=root) flg[u]=1;
			
		}
		else low[u]=min(low[u],dfn[v]);
	}
	if(ch>=2&&root==u) flg[u]=1;
}
int main(){
	scanf("%lld%lld",&n,&m);
	for(ll i=1,u,v;i<=m;i++) 
		scanf("%lld%lld",&u,&v),add(u,v),add(v,u); 
	for(ll i=1;i<=n;i++)
		if(!dfn[i])
			root=i,tarjan(i);
	for(ll i=1;i<=n;i++)
		if(flg[i])
			++ans;
	printf("%lld\n",ans);
	for(ll i=1;i<=n;i++)
		if(flg[i])
			printf("%lld ",i);
	return 0;
}
```

### å‰²è¾¹

å‰²è¾¹çš„æ±‚æ³•å’Œå‰²ç‚¹çš„æ±‚æ³•ç±»ä¼¼ï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨ç›¸åŒå®šä¹‰çš„$low$å’Œ$dfn$ã€‚

å¾ˆæ˜¾ç„¶ï¼Œæ ‘æè¾¹ä½¿å¾—æ•´ä¸ªå›¾è¿é€šï¼Œè€Œéæ ‘è¾¹åˆ é™¤åå¹¶ä¸å½±å“å›¾çš„è¿é€šæ€§ï¼Œå› æ­¤**å‰²è¾¹ä¸€å®šæ˜¯æ ‘æè¾¹**ã€‚

å‡è®¾å½“å‰èŠ‚ç‚¹ä¸º$u$ï¼Œå®ƒæœ‰å­èŠ‚ç‚¹$v$ï¼Œé‚£ä¹ˆè¾¹$(u,v)$ä¸ºå‰²è¾¹æ—¶å½“ä¸”ä»…å½“$low(v) > dfn(u)$ï¼Œåªè¦$v$çš„èŠ‚ç‚¹èƒ½é€šè¿‡éæ ‘è¾¹æ¥åˆ°æ¯”$u$çš„$dfn$æ›´å°çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆ$u,v$å°±ä¸æ˜¯å‰²è¾¹ï¼Œä¸å–ç­‰å·çš„åŸå› æ˜¯å®ƒæ˜¯ä¸€æ¡è¾¹è€Œéä¸€ä¸ªèŠ‚ç‚¹ã€‚

ç°åœ¨å”¯ä¸€çš„é—®é¢˜å°±æ˜¯åˆ¤æ–­ä¸€æ¡è¾¹æ˜¯å¦ä¸ºéæ ‘è¾¹ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å°†$v \rightarrow uâ€‹$ï¼ˆ$uâ€‹$æ˜¯$vâ€‹$çš„çˆ¶äº²ï¼‰è¯†åˆ«æˆéæ ‘è¾¹ï¼Œè¿™æ ·å¯èƒ½å°†æ ‘è¾¹ä¹Ÿè¯†åˆ«æˆéæ ‘è¾¹ã€‚

tarjan

```cpp
#include<bits/stdc++.h>
#define int long long
const int N=1e6+1;
using namespace std;
struct fy
{
	int v,next;
}edge[N];
struct fy_
{
	int from,to;
}E[N];
int dfn[N],low[N],n,m,x,y,idx,head[N],res,cnt,IDX;
bool g[N];
inline void add(int x,int y)
{
	edge[++cnt].v=y,edge[cnt].next=head[x],head[x]=cnt;
}
inline void dfs(int u,int fa)
{
	dfn[u]=low[u]=++idx;
	for(int i=head[u];i;i=edge[i].next)
	{
		int v=edge[i].v;
		if(!dfn[v])
		{
			dfs(v,u);
			low[u]=min(low[u],low[v]);
			if(low[v]>dfn[u])
				E[++IDX].from=min(u,v),E[IDX].to=max(u,v);
		}
		else if(v!=fa&&dfn[v]<dfn[u])
			low[u]=min(low[u],dfn[v]);
	}
}
signed main()
{
	scanf("%lld%lld",&n,&m);
	for(int i=1;i<=m;i++)
	{
		scanf("%lld%lld",&x,&y);
		add(x,y),add(y,x);
	}
	dfs(1,-1);
	for(int i=1;i<=IDX;i++)
		printf("%lld %lld\n",E[i].from,E[i].to);
}
```

æ ‘ä¸Šå·®åˆ†

å¯¹äºæ¯ä¸€æ¡éæ ‘è¾¹ï¼Œåœ¨å…¶æ ‘ä¸Šæ·±åº¦è¾ƒå°çš„ç‚¹å¤„æ‰“ä¸Š `-1` æ ‡è®°ï¼Œåœ¨å…¶æ ‘ä¸Šæ·±åº¦è¾ƒå¤§çš„ç‚¹å¤„æ‰“ä¸Š `+1` æ ‡è®°ã€‚ç„¶åæ±‚å‡ºæ¯ä¸ªç‚¹çš„å­æ ‘å†…éƒ¨çš„æ ‡è®°ä¹‹å’Œã€‚å¯¹äºä¸€ä¸ªç‚¹uï¼Œå…¶å­æ ‘å†…éƒ¨çš„æ ‡è®°ä¹‹å’Œç­‰äºè¦†ç›–äº† uå’Œuçš„çˆ¶äº²ä¹‹é—´çš„æ ‘è¾¹çš„éæ ‘è¾¹æ•°é‡ã€‚è‹¥è¿™ä¸ªå€¼é0ï¼Œåˆ™uå’Œuçš„çˆ¶äº²ä¹‹é—´çš„æ ‘è¾¹ä¸æ˜¯æ¡¥ï¼Œå¦åˆ™æ˜¯æ¡¥ã€‚

## åŒè”é€šåˆ†é‡

åŒè¿é€šåˆ†é‡åˆ†ä¸º**ç‚¹åŒè¿é€šåˆ†é‡**å’Œ**è¾¹åŒè¿é€šåˆ†é‡**ã€‚

è¾¹åŒè¿é€šå…·æœ‰ä¼ é€’æ€§ï¼Œç‚¹åŒè¿é€š **ä¸** å…·æœ‰ä¼ é€’æ€§

- ç‚¹åŒè¿é€šå›¾ï¼š**ä¸å­˜åœ¨å‰²ç‚¹çš„æ— å‘è¿é€šå›¾**æˆ‘ä»¬ç§°ä¸º**ç‚¹åŒè”é€šå›¾**ã€‚

- è¾¹åŒè¿é€šå›¾ï¼š**ä¸å­˜åœ¨å‰²è¾¹çš„æ— å‘è¿é€šå›¾**æˆ‘ä»¬ç§°ä¸º**è¾¹åŒè”é€šå›¾**ã€‚

- ç‚¹åŒè¿é€šåˆ†é‡ï¼ˆç‚¹åŒï¼‰ï¼šä¸€å¼ å›¾çš„æå¤§ç‚¹åŒè¿é€šå­å›¾ç§°ä¸º**ç‚¹åŒè¿é€šåˆ†é‡ï¼ˆV-BCCï¼‰ã€‚**

- è¾¹åŒè¿é€šåˆ†é‡ï¼ˆè¾¹åŒï¼‰ï¼šä¸€å¼ å›¾çš„æå¤§è¾¹åŒè¿é€šå­å›¾ç§°ä¸º**è¾¹åŒè¿é€šåˆ†é‡ï¼ˆE-BCCï¼‰**ã€‚

- ç‚¹åŒè¿é€šï¼šè‹¥ä¸¤ç‚¹$u,v$åœ¨åŒä¸€ä¸ªç‚¹åŒè¿é€šåˆ†é‡å†…ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°$u,v$ç‚¹åŒè¿é€šã€‚

- è¾¹åŒè”é€šï¼šè‹¥ä¸¤ç‚¹$u,v$åœ¨åŒä¸€ä¸ªè¾¹åŒè¿é€šåˆ†é‡å†…ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°$u,v$è¾¹åŒè¿é€šã€‚

  åœ¨ä¸€å¼ æ— å‘å›¾ä¸­ï¼Œå¦‚æœ$(u,v)$ç›´æ¥ç›¸è¿ï¼Œé‚£ä¹ˆ$u,v$ç‚¹åŒè¿é€šï¼Œä½†ä¸ä¸€å®šè¾¹åŒè¿é€šã€‚

  åŒæ—¶ï¼ŒåŒè¿é€šåˆ†é‡è¿˜æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ€§è´¨ï¼Œæˆ‘ä»¬å°†å¼ºè¿é€šåˆ†é‡ç¼©ç‚¹åå¯ä»¥å¾—åˆ°ä¸€ä¸ª **DAG**ï¼Œä½†æ˜¯åŒè¿é€šåˆ†é‡ç¼©ç‚¹ä¹‹åå¯ä»¥å¾—åˆ°**ä¸€æ£µæ ‘**ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨è¿›é˜¶ä¸­è¦è®²çš„**åœ†æ–¹æ ‘**ã€‚

### è¾¹åŒè¿é€šåˆ†é‡

è¾¹åŒè¿é€šåˆ†é‡äº‹å®ä¸Šå¾ˆå¥½æ±‚ã€‚

æˆ‘ä»¬åªéœ€å°†è¯¥æ— å‘å›¾çš„æ‰€æœ‰å‰²è¾¹åˆ å»ï¼Œæ•´å¼ å›¾å°±ä¼šåˆ†è£‚æˆ**å‰²è¾¹æ•°é‡+1**ä¸ªè”é€šå—ï¼Œè¿™äº›è”é€šå—å†…ä¸å­˜åœ¨å‰²è¾¹ï¼Œä¹Ÿå°±æ˜¯è¯¥å›¾åˆ†è£‚æˆäº†è‹¥å¹²ä¸ªè¾¹åŒè¿é€šåˆ†é‡ã€‚

```cpp
#include <bits/stdc++.h>
#define ll long long
using namespace std;
const ll Maxn=4e6+7;
struct edge1{
	ll u,v,Next;
}Edge[Maxn<<1];
ll n,m,tot=1,f[Maxn];
ll low[Maxn],dfn[Maxn],cnt,head[Maxn];
ll cl;
vector<ll>ans[Maxn];
bool flg[Maxn],vis[Maxn];
inline void add(ll u,ll v){
	Edge[++tot]=(edge1){u,v,head[u]},head[u]=tot;
}
void tarjan(ll u){
	dfn[u]=low[u]=++cnt;
	for(ll i=head[u];i;i=Edge[i].Next){
		if(i==(f[u]^1)) continue;
		ll v=Edge[i].v;
		if(!dfn[v]){
			f[v]=i;
			tarjan(v);
			low[u]=min(low[u],low[v]);
			if(low[v]>dfn[u]) flg[i]=flg[i^1]=1;
		}
		else low[u]=min(low[u],dfn[v]);
	}
}
void DFS(ll u){
	vis[u]=1;
	ans[cl].push_back(u);
	for(ll i=head[u];i;i=Edge[i].Next){
		if(!flg[i]&&!vis[Edge[i].v]){
			DFS(Edge[i].v);
		}
	}
}
int main(){
	scanf("%lld%lld",&n,&m);
	for(ll i=1,u,v;i<=m;i++) 
		scanf("%lld%lld",&u,&v),add(u,v),add(v,u); 
	for(ll i=1;i<=n;i++) if(!dfn[i]) tarjan(i);
	for(ll i=1;i<=n;i++) if(!vis[i]) ++cl,DFS(i);
	printf("%lld\n",cl);
	for(ll i=1;i<=cl;i++,puts("")){
		printf("%lld ",ans[i].size());
		for(auto j:ans[i]) printf("%lld ",j);
	}
	return 0;
}
```

### ç‚¹åŒè¿é€šåˆ†é‡

å¯¹äºä¸€ä¸ªç‚¹åŒï¼Œå®ƒåœ¨ DFS æœç´¢æ ‘ä¸­$dfn$å€¼æœ€å°çš„ç‚¹ä¸€å®šæ˜¯å‰²ç‚¹æˆ–è€…æ ‘æ ¹ã€‚

å½“è¿™ä¸ªç‚¹æ˜¯å‰²ç‚¹æ—¶ï¼Œå®ƒæ‰€å±çš„ç‚¹åŒå¿…å®šä¸å¯ä»¥å‘å®ƒçš„çˆ¶äº²æ–¹å‘åŒ…æ‹¬æ›´å¤šç‚¹ï¼Œå› ä¸ºä¸€æ—¦å›æº¯ï¼Œå®ƒå°±æˆä¸ºäº†æ–°çš„å­å›¾çš„ä¸€ä¸ªå‰²ç‚¹ï¼Œä¸æ˜¯ç‚¹åŒã€‚æ‰€ä»¥å®ƒåº”è¯¥å½’åˆ°å…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå­æ ‘é‡Œçš„ç‚¹åŒä¸­ã€‚

å½“è¿™ä¸ªç‚¹æ˜¯æ ‘æ ¹æ—¶ï¼Œå®ƒçš„$dfn$å€¼æ˜¯æ•´æ£µæ ‘é‡Œæœ€å°çš„ã€‚å®ƒè‹¥æœ‰ä¸¤ä¸ªä»¥ä¸Šå­æ ‘ï¼Œé‚£ä¹ˆå®ƒæ˜¯ä¸€ä¸ªå‰²ç‚¹ï¼›å®ƒè‹¥åªæœ‰ä¸€ä¸ªå­æ ‘ï¼Œå®ƒä¸€å®šå±äºå®ƒçš„ç›´ç³»å„¿å­çš„ç‚¹åŒï¼Œå› ä¸ºåŒ…æ‹¬å®ƒï¼›å®ƒè‹¥æ˜¯ä¸€ä¸ªç‹¬ç«‹ç‚¹ï¼Œè§†ä½œä¸€ä¸ªå•ç‹¬çš„ç‚¹åŒã€‚

æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªç‚¹åŒä¸€å®šåœ¨è¿™ä¸¤ç±»ç‚¹çš„å­æ ‘ä¸­ã€‚

æˆ‘ä»¬ç”¨æ ˆç»´æŠ¤ç‚¹ï¼Œå½“é‡åˆ°è¿™ä¸¤ç±»ç‚¹æ—¶ï¼Œå°†å­æ ‘å†…ç›®å‰ä¸å±äºå…¶å®ƒç‚¹åŒçš„éå‰²ç‚¹æˆ–åœ¨å­æ ‘ä¸­çš„å‰²ç‚¹å½’åˆ°ä¸€ä¸ªæ–°çš„ç‚¹åŒã€‚æ³¨æ„è¿™ä¸ªç‚¹å¯èƒ½è¿˜æ˜¯ä¸å…¶å®ƒç‚¹åŒçš„å…¬å…±ç‚¹ï¼Œæ‰€ä»¥ä¸èƒ½å°†å…¶å‡ºæ ˆã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 5e5 + 5, M = 4e6 + 5;
int cnt = 1, fir[N], nxt[M], to[M];
int s[M], top, bcc, low[N], dfn[N], idx, n, m;
vector<int> ans[N];
inline void tarjan(int u, int fa) {
	int son = 0;
	low[u] = dfn[u] = ++idx;
	s[++top] = u;
	for(int i = fir[u]; i; i = nxt[i]) {
		int v = to[i];
		if(!dfn[v]) {
			son++;
			tarjan(v, u);
			low[u] = min(low[u], low[v]);
			if(low[v] >= dfn[u]) {
				bcc++;
				while(s[top + 1] != v) ans[bcc].push_back(s[top--]);//å°†å­æ ‘å‡ºæ ˆ
				ans[bcc].push_back(u);//æŠŠå‰²ç‚¹/æ ‘æ ¹ä¹Ÿä¸¢åˆ°ç‚¹åŒé‡Œ
			}
		} else if(v != fa) low[u] = min(low[u], dfn[v]);
	}
	if(fa == 0 && son == 0) ans[++bcc].push_back(u);//ç‰¹åˆ¤ç‹¬ç«‹ç‚¹
}
inline void add(int u, int v) {
	to[++cnt] = v;
	nxt[cnt] = fir[u];
	fir[u] = cnt;
}
int main() {
	scanf("%d%d", &n, &m);
	for(int i = 1; i <= m; i++) {
		int u, v;
		scanf("%d%d", &u, &v);
		add(u, v), add(v, u);
	}
	for(int i = 1; i <= n; i++) {
		if(dfn[i]) continue;
		top = 0;
		tarjan(i, 0);
	}
	printf("%d\n", bcc);
	for(int i = 1; i <= bcc; i++) {
		printf("%d ", ans[i].size());
		for(int j : ans[i]) printf("%d ", j);
		printf("\n");
	}
	return 0;
}
```


## æ ‘é“¾å‰–åˆ† HLD

```cpp 
using ll = long long;
using Graph = vector<vector<int>>;
struct HLD
{
    vector<int> id, sz, son, fa, top, dep;
    int root, tot;
    Graph g;

    HLD() {};

    HLD(int _n, int _root = 1)
    {
        init(_n + 1, _root);
    }

    HLD(Graph &_g, int _root = 1)
    {
        init(_g, _root);
    }

    // fundamental functions
    void init(Graph &_g, int _root)
    {
        g = _g;
        id.resize(_g.size());
        sz.resize(_g.size());
        son.resize(_g.size());
        fa.resize(_g.size());
        top.resize(_g.size());
        dep.resize(_g.size());
        tot = 0;
        root = _root;

        calc();
    }

    void init(int n, int _root)
    {
        id.resize(n);
        sz.resize(n);
        son.resize(n);
        fa.resize(n);
        top.resize(n);
        dep.resize(n);
        tot = 0;
        root = _root;
        g.assign(n, {});
        // remember calc()
    }

    void calc()
    { // prepare fa, sz, dep, son(heavy son)
        function<void(int, int)> dfs = [&](int now, int f)
        {
            fa[now] = f;
            sz[now] = 1;
            dep[now] = dep[f] + 1;
            for (auto i : g[now])
                if (i != f)
                {
                    dfs(i, now);
                    sz[now] += sz[i];
                    if (sz[i] > sz[son[now]])
                        son[now] = i;
                }
        };
        dfs(root, root);

        // id -> dfn; top -> head of the chain
        dfs = [&](int now, int f)
        {
            top[now] = f;
            id[now] = ++tot;
            if (son[now] == 0)
                return;
            dfs(son[now], f); // heavy chain
            for (auto i : g[now])
                if (i != fa[now] && i != son[now])
                    dfs(i, i); // light chain
        };
        dfs(root, root);
    }

    void addEdge(int u, int v)
    {
        g[u].push_back(v), g[v].push_back(u);
    }

    // tool functions
    int lca(int x, int y)
    {
        while (top[x] != top[y])
        {
            if (dep[top[x]] > dep[top[y]])
                x = fa[top[x]];
            else
                y = fa[top[y]];
        }
        return (dep[x] > dep[y]) ? y : x;
    }

    int dist(int u, int v)
    {
        return dep[u] + dep[v] - 2 * dep[lca(u, v)];
    }
};
```

å¤„ç†ï¼š
* ä»¥ `u` ä¸ºæ ¹çš„å­æ ‘åœ¨ `id[u], id[u] + sz[u] - 1` åŒºé—´ä¸Šã€‚ 
* å¤„ç†ä¸¤ç‚¹é—´ç®€å•è·¯å¾„çš„å®ä¾‹ï¼Œå…¶ä¸­updateæ˜¯åŒºé—´åŠ ã€‚
```cpp
void pathAdd(int u, int v, int x)
{
    while (top[u] != top[v])
    {
        if (dep[top[u]] < dep[top[v]])
            swap(u, v);
        update(id[top[u]], id[u], x);
        u = fa[top[u]];
    }
    if (dep[u] > dep[v])
        swap(u, v);
    update(id[u], id[v], x);
}
```
* å¯¹`u, v`ä¹‹é—´ç®€å•è·¯å¾„åšæ ‘ä¸Šå·®åˆ†çš„åšæ³•æ˜¯ `tag[u]++, tag[v]++, tag[lca]--, tag[fa[lca]]--`ã€‚

## äºŒåˆ†å›¾æœ€å¤§åŒ¹é…é—®é¢˜
åŒˆç‰™åˆ©ç®—æ³•

ç”¨äºè§£å†³äºŒåˆ†å›¾æœ€å¤§åŒ¹é…é—®é¢˜ï¼ˆå¦‚ï¼šå­˜åœ¨è‹¥å¹²ç”·å¥³åŠå…¶å–œæ¬¢å…³ç³»ï¼ˆæ²¡æœ‰åŒæ€§æ‹ï¼‰ï¼Œæ±‚æœ€å¤§åŒ¹é…æ•°/åŒ¹é…æ—¶äººä¸å¯é‡å¤ä½¿ç”¨ï¼‰

dfsè§£ï¼š[P3386 äºŒåˆ†å›¾æœ€å¤§åŒ¹é… æ´›è°·](https://www.luogu.com.cn/problem/P3386)

```cpp
	//ç”·å¥³ç”Ÿæ¨¡å‹
    vector<ll> edge[maxn];//edge[u]é‡Œé¢æœ‰vä»£è¡¨ç”·ç”Ÿuå’Œå¥³ç”Ÿvå¯ä»¥ç›¸è¿
    ll vis[maxn];//vis[v],åœ¨è¯¥æ¬¡dfsä¸‹ï¼Œå¥³ç”Ÿvæ˜¯å¦å·²ç»é…å¯¹
    ll match[maxn];//match[v]=u,å¥³ç”Ÿvå’Œç”·ç”Ÿué…å¯¹
bool dfs(ll now){
    for(auto t:edge[now]){
        if(vis[t]) continue;
        vis[t]=1;
        if(!match[t]||dfs(match[t])){
            match[t]=now;
            return true;
        }
    }
    return false;
}
void solve(){
    ll n,m,e;
    cin>>n>>m>>e;
    rep(i,1,e){
        ll u,v;
        cin>>u>>v;
        edge[u].push_back(v);
    }
    ll ans=0;
    rep(i,1,n){
        rep(j,1,m){
            vis[j]=0;
        }
        if(dfs(i)) ans++;
    }
    cout<<ans<<endl;
}
```
è¿™é“é¢˜æ¯”è¾ƒç‰¹æ®Šï¼Œä¸¤ç±»ç‚¹æ˜¯å¯ä»¥åœ¨ä¸€å¼€å§‹å°±æ˜ç¡®åˆ†å¥½çš„ï¼Œä¸‹é¢ç»™å‡ºä¸€ä¸ªæœªçŸ¥åˆ†ç±»çš„ï¼Œè¾ƒä¸ºé€šç”¨çš„è§£

```cpp
    vector<ll> edge[maxn];
    ll vis[maxn];
    ll match[maxn];
    ll tag;
bool dfs(ll now){
    for(auto t:edge[now]){
        if(vis[t]==tag) continue;
        vis[t]=tag;
        if(!match[t]||dfs(match[t])){
            match[t]=now;
            match[now]=t;
            return true;
        }
    }
    return false;
}
ll hungarian(ll n,ll m){
    ll ans=0;
    rep(i,1,n){
        if(match[i]) continue;
        tag=i;//ç±»ä¼¼æ—¶é—´æˆ³
        if(dfs(i)) ans++;
    }
    return ans;
}
```